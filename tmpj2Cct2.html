<!DOCTYPE html>
<!--[if lte IE 8]><html class="lt-ie9"><![endif]-->
<!--[if gt IE 8]><!--><html><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>twine1-4version</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<!--
Made in Twine 1.4.2 (running on Darwin 14.5.0)
Built on 21 Nov 2016 at 13:47:15, -0500

Jonah is based on:

TiddlyWiki 1.2.39 by Jeremy Ruston, (jeremy [at] osmosoft [dot] com)

Published under a BSD open source license

Copyright (c) Osmosoft Limited 2005

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

Redistributions of source code must retain the above copyright notice, this
list of conditions and the following disclaimer.

Redistributions in binary form must reproduce the above copyright notice, this
list of conditions and the following disclaimer in the documentation and/or other
materials provided with the distribution.

Neither the name of the Osmosoft Limited nor the names of its contributors may be
used to endorse or promote products derived from this software without specific
prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY
EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT
SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
DAMAGE.
-->
<script title="engine">
(function(){

function clone(a){var constructor,b,proto;if(!a||typeof a!="object"){return a
}constructor=a.constructor;if(constructor==Date||constructor==RegExp){b=new constructor(a)}else{if(constructor==Array){b=[]}else{if(a.nodeType&&typeof a.cloneNode=="function"){b=a.cloneNode(true)}else{proto=(typeof Object.getPrototypeOf=="function"?Object.getPrototypeOf(a):a.__proto__);b=proto?Object.create(proto):{}}}}for(var property in a){if(Object.prototype.hasOwnProperty.call(a,property)&&!isCyclic(a[property])){if(typeof a[property]=="object"){try{b[property]=clone(a[property]);continue}catch(e){}}b[property]=a[property]}}return b}function isCyclic(obj){var properties=[];return(function recurse(obj){var key,i,ownProps=[];if(obj&&typeof obj=="object"){if(properties.indexOf(obj)>-1){return true
}properties.push(obj);for(key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)&&recurse(obj[key])){return true
}}}return false}(obj))}function insertElement(a,d,f,c,e){var b=document.createElement(d);if(f){b.id=f}if(c){b.className=c}if(e){insertText(b,e)}if(a){a.appendChild(b)}return b}function addClickHandler(el,fn){if(el.addEventListener){el.addEventListener("click",fn)}else{if(el.attachEvent){el.attachEvent("onclick",fn)}}}function insertText(a,b){return a.appendChild(document.createTextNode(b))}function removeChildren(a){while(a.hasChildNodes()){a.removeChild(a.firstChild)}}function findPassageParent(el){while(el&&el!=document.body&&!~el.className.indexOf("passage")){el=el.parentNode}return el==document.body?null:el}function setPageElement(c,b,a){var place;if(place=(typeof c=="string"?document.getElementById(c):c)){removeChildren(place);if(tale.has(b)){new Wikifier(place,tale.get(b).processText())}else{new Wikifier(place,a)}}}var scrollWindowInterval;function scrollWindowTo(e,margin){var d=window.scrollY?window.scrollY:document.documentElement.scrollTop,m=window.innerHeight?window.innerHeight:document.documentElement.clientHeight,g=k(e),j=(d>g)?-1:1,b=0,c=Math.abs(d-g);scrollWindowInterval&&window.clearInterval(scrollWindowInterval);if(c){scrollWindowInterval=window.setInterval(h,25)}function h(){b+=0.1;window.scrollTo(0,d+j*(c*Math.easeInOut(b)));if(b>=1){window.clearInterval(scrollWindowInterval)}}function k(o){var p=a(o),h=o.offsetHeight,n=d+m;p=Math.min(Math.max(p+(margin||0)*(p<d?-1:1),0),n);if(p<d){return p
}else{if(p+h>n){if(h<m){return(p-(m-h)+20)}else{return p
}}else{return p
}}}function a(l){var m=0;while(l.offsetParent){m+=l.offsetTop;l=l.offsetParent}return m}}function delta(old,neu){var vars,ret={};if(old&&neu){for(vars in neu){if(neu[vars]!==old[vars]){ret[vars]=neu[vars]}}}return ret}function decompile(val){var i,ret;if((typeof val!="object"&&typeof val!="function")||!val){return val
}else{if(val instanceof Passage){return{"[[Passage]]":val.id}}else{if(Array.isArray(val)){ret=[]}else{ret={}}}}for(i in val){if(Object.prototype.hasOwnProperty.call(val,i)&&!isCyclic(val[i])){ret[i]=decompile(val[i])}}if(typeof val=="function"||val instanceof RegExp){try{internalEval(val+"");ret["[[Call]]"]=val+""}catch(e){ret["[[Call]]"]="function(){}"}}return ret}function recompile(val){var i,ret=val;if(val&&typeof val=="object"){if(typeof val["[[Passage]]"]=="number"){return tale.get(val["[[Passage]]"])}if(typeof val["[[Call]]"]=="string"){try{ret=internalEval(val["[[Call]]"])}catch(e){}}for(i in val){if(Object.prototype.hasOwnProperty.call(val,i)){ret[i]=recompile(val[i])}}}return ret}function addStyle(b){if(document.createStyleSheet){document.getElementsByTagName("head")[0].insertAdjacentHTML("beforeEnd","&nbsp;<style>"+b+"</style>")}else{var a=document.createElement("style");a.appendChild(document.createTextNode(b));document.getElementsByTagName("head")[0].appendChild(a)}}function alterCSS(text){var temp="",imgPassages=tale.lookup("tags","Twine.image");text=text.replace(/\/\*(?:[^\*]|\*(?!\/))*\*\//g,"");text=text.replace(/:link/g,"[class*=Link]");text=text.replace(/:visited/g,".visitedLink");text=text.replace(/@import\s+(?:url\s*\(\s*['"]?|['"])[^"'\s]+(?:['"]?\s*\)|['"])\s*([\w\s\(\)\d\:,\-]*);/g,function(e){temp+=e;return""});text=temp+text;return text.replace(new RegExp(Wikifier.imageFormatter.lookahead,"gim"),function(m,p1,p2,p3,src){for(var i=0;i<imgPassages.length;i++){if(imgPassages[i].title==src){src=imgPassages[i].text;break}}return"url("+src+")"})}function setTransitionCSS(styleText){styleText=alterCSS(styleText);var style=document.getElementById("transitionCSS");style.styleSheet?(style.styleSheet.cssText=styleText):(style.innerHTML=styleText)}function throwError(a,b,tooltip){if(a){var elem=insertElement(a,"span",null,"marked",b);tooltip&&elem.setAttribute("title",tooltip)}else{alert("Regrettably, this "+tale.identity()+"'s code just ran into a problem:\n"+b+".\n"+softErrorMessage)}}Math.easeInOut=function(a){return(1-((Math.cos(a*Math.PI)+1)/2))};String.prototype.readMacroParams=function(keepquotes){var exec,re=/(?:\s*)(?:(?:"([^"]*)")|(?:'([^']*)')|(?:\[\[((?:[^\]]|\](?!\]))*)\]\])|([^"'\s]\S*))/mg,params=[];do{var val;exec=re.exec(this);if(exec){if(exec[1]){val=exec[1];keepquotes&&(val='"'+val+'"')}else{if(exec[2]){val=exec[2];keepquotes&&(val="'"+val+"'")}else{if(exec[3]){val=exec[3];keepquotes&&(val='"'+val.replace('"','\\"')+'"')}else{if(exec[4]){val=exec[4]}}}}val&&params.push(val)}}while(exec);return params};String.prototype.readBracketedList=function(){var c,b="\\[\\[([^\\]]+)\\]\\]",a="[^\\s$]+",e="(?:"+b+")|("+a+")",d=new RegExp(e,"mg"),f=[];do{c=d.exec(this);if(c){if(c[1]){f.push(c[1])}else{if(c[2]){f.push(c[2])}}}}while(c);return(f)};function rot13(s){return s.replace(/[a-zA-Z]/g,function(c){return String.fromCharCode((c<="Z"?90:122)>=(c=c.charCodeAt()+13)?c:c-26)})}Object.create||(function(){var F=function(){};Object.create=function(o){if(typeof o!="object"){throw TypeError()}F.prototype=o;return new F()}})();String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s\s*/,"").replace(/\s\s*$/,"")});Array.isArray||(Array.isArray=function(arg){return Object.prototype.toString.call(arg)==="[object Array]"});Array.prototype.indexOf||(Array.prototype.indexOf=function(b,d){d=(d==null)?0:d;var a=this.length;for(var c=d;c<a;c++){if(this[c]==b){return c
}}return -1});Array.prototype.forEach||(Array.prototype.forEach=function(fun){if(this==null){throw TypeError()}var t=Object(this);var len=+t.length;if(typeof fun!="function"){throw TypeError()}var thisArg=arguments.length>=2?arguments[1]:void 0;for(var i=0;i<len;i++){if(i in t){fun.call(thisArg,t[i],i,t)}}});(function(){function t(t){this.message=t}var e=window,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";t.prototype=Error(),t.prototype.name="InvalidCharacterError",e.btoa||(e.btoa=function(e){for(var o,n,a=0,i=r,c="";e.charAt(0|a)||(i="=",a%1);c+=i.charAt(63&o>>8-8*(a%1))){if(n=e.charCodeAt(a+=0.75),n>255){throw new t()}o=o<<8|n}return c}),e.atob||(e.atob=function(e){if(e=e.replace(/=+$/,""),1==e.length%4){throw new t()}for(var o,n,a=0,i=0,c="";n=e.charAt(i++);~n&&(o=a%4?64*o+n:n,a++%4)?c+=String.fromCharCode(255&o>>(6&-2*a)):0){n=r.indexOf(n)}return c})})();var hasTransition="transition" in document.documentElement.style||"-webkit-transition" in document.documentElement.style;function fade(f,c){var h;var e=f.cloneNode(true);var g=(c.fade=="in")?1:-1;f.parentNode.replaceChild(e,f);if(c.fade=="in"){h=0;e.style.visibility="visible"}else{h=1
}b(e,h);var a=window.setInterval(d,25);function d(){h+=0.05*g;b(e,Math.easeInOut(h));if(((g==1)&&(h>=1))||((g==-1)&&(h<=0))){f.style.visibility=(c.fade=="in")?"visible":"hidden";if(e.parentNode){e.parentNode.replaceChild(f,e)}window.clearInterval(a);if(c.onComplete){c.onComplete.call(f)}}}function b(k,j){var l=Math.floor(j*100);k.style.zoom=1;k.style.filter="alpha(opacity="+l+")";k.style.opacity=j}}function History(){this.history=[{passage:null,variables:{}}];this.id=new Date().getTime()+"";this.hash=""}History.prototype.encodeHistory=function(b,noVars){var ret=".",vars,type,hist=this.history[b],d=this.history[b+1]?delta(this.history[b+1].variables,hist.variables):hist.variables;function vtob(val){try{return window.btoa(unescape(encodeURIComponent(JSON.stringify(decompile(val)))))}catch(e){return"0"
}}if(!hist.passage||hist.passage.id==null){return""
}ret+=hist.passage.id.toString(36);if(noVars){return ret
}for(vars in d){type=typeof d[vars];if(type!="undefined"){ret+="$"+vtob(vars)+","+vtob(d[vars])}}for(vars in hist.linkVars){type=typeof hist.linkVars[vars];if(type!="function"&&type!="undefined"){ret+="["+vtob(vars)+","+vtob(hist.linkVars[vars])}}return ret};History.decodeHistory=function(str,prev){var name,splits,variable,c,d,ret={variables:clone(prev.variables)||{}},match=/([a-z0-9]+)((?:\$[A-Za-z0-9\+\/=]+,[A-Za-z0-9\+\/=]+)*)((?:\[[A-Za-z0-9\+\/=]+,[A-Za-z0-9\+\/=]+)*)/g.exec(str);function btov(str){try{return recompile(JSON.parse(decodeURIComponent(escape(window.atob(str)))))}catch(e){return 0
}}if(match){name=parseInt(match[1],36);if(!tale.has(name)){return false
}if(match[2]){ret.variables||(ret.variables={});splits=match[2].split("$");for(c=0;c<splits.length;c++){variable=splits[c].split(",");d=btov(variable[0]);if(d){ret.variables[d]=btov(variable[1])}}}if(match[3]){ret.linkVars||(ret.linkVars={});splits=match[3].split("[");for(c=0;c<splits.length;c++){variable=splits[c].split(",");d=btov(variable[0]);if(d){ret.linkVars[d]=btov(variable[1])}}}ret.passage=tale.get(name);return ret}};History.prototype.save=function(){var hist,b,a="";for(b=this.history.length-1;b>=0;b--){hist=this.history[b];if(!hist){break
}a+=this.encodeHistory(b)}return"#"+a};History.prototype.restore=function(){var a,b,c,vars;try{if(!window.location.hash||(window.location.hash=="#")){if(testplay){if(tale.has("StoryInit")){new Wikifier(insertElement(null,"span"),tale.get("StoryInit").text)}this.display(testplay,null,"quietly");return true}return false}if(window.location.hash.substr(0,2)=="#!"){c=window.location.hash.substr(2).split("_").join(" ");this.display(c,null,"quietly");return true}a=window.location.hash.replace("#","").split(".");for(b=0;b<a.length;b++){vars=History.decodeHistory(a[b],vars||{});if(vars){if(b==a.length-1){vars.variables=clone(this.history[0].variables);for(c in this.history[0].linkVars){vars.variables[c]=clone(this.history[0].linkVars[c])}this.history.unshift(vars);this.display(vars.passage.title,null,"back")}else{this.history.unshift(vars)}}}return true}catch(d){return false
}};History.prototype.saveVariables=function(c,el,callback){if(typeof callback=="function"){callback.call(el)}this.history.unshift({passage:c,variables:clone(this.history[0].variables)})};var restart=History.prototype.restart=function(){if(typeof window.history.replaceState=="function"){(typeof this.pushState=="function")&&this.pushState(true,window.location.href.replace(/#.*$/,""));window.location.reload()}else{window.location.hash=""}};var version={major:4,minor:2,revision:0,date:new Date("2014"),extensions:{}};var testplay,tale,state,prerender={},postrender={},macros=window.macros={};version.extensions.displayMacro={major:2,minor:0,revision:0};macros.display={parameters:[],handler:function(place,macroName,params,parser){var t,j,output,oldDisplayParams,name=parser.fullArgs();if(macroName!="display"){output=macroName;params=parser.fullMatch().replace(/^\S*|>>$/g,"").readMacroParams(true);try{for(j=0;j<params.length;j++){params[j]=internalEval(Wikifier.parse(params[j]))}}catch(e){throwError(place,parser.fullMatch()+" bad argument: "+params[j],parser.fullMatch());return}}else{try{output=internalEval(name)}catch(e){}if(output==null){if(tale.has(name)){output=name
}}}if(!output){throwError(place,"<<"+macroName+'>>: "'+name+'" did not evaluate to a passage name',parser.fullMatch())}else{if(!tale.has(output+"")){throwError(place,"<<"+macroName+'>>: The "'+output+'" passage does not exist',parser.fullMatch())}else{oldDisplayParams=this.parameters;this.parameters=params;t=tale.get(output+"");if(t.tags.indexOf("script")>-1){scriptEval(t)}else{new Wikifier(place,t.processText())}this.parameters=oldDisplayParams
}}}};version.extensions.actionsMacro={major:1,minor:2,revision:0};macros.actions={handler:function(a,f,g){var v=state.history[0].variables,e=insertElement(a,"ul");if(!v["actions clicked"]){v["actions clicked"]={}}for(var b=0;b<g.length;b++){if(v["actions clicked"][g[b]]){continue
}var d=insertElement(e,"li");var c=Wikifier.createInternalLink(d,g[b],(function(link){return function(){state.history[0].variables["actions clicked"][link]=true}}(g[b])));insertText(c,g[b])}}};version.extensions.printMacro={major:1,minor:1,revision:1};macros.print={handler:function(place,macroName,params,parser){var args=parser.fullArgs(macroName!="print"),output;try{output=internalEval(args);if(output!=null&&(typeof output!="number"||!isNaN(output))){new Wikifier(place,""+output)}}catch(e){throwError(place,"<<print>> bad expression: "+params.join(" "),parser.fullMatch())}}};version.extensions.setMacro={major:1,minor:1,revision:0};macros.set={handler:function(a,b,c,parser){macros.set.run(a,parser.fullArgs(),parser,c.join(" "))},run:function(a,expression,parser,original){try{return internalEval(expression)}catch(e){throwError(a,"bad expression: "+(original||expression),parser?parser.fullMatch():expression)}}};version.extensions.ifMacros={major:2,minor:0,revision:0};macros["if"]={handler:function(place,macroName,params,parser){var conditions=[],clauses=[],rawConds=[],srcOffset=parser.source.indexOf(">>",parser.matchStart)+2,src=parser.source.slice(srcOffset),endPos=-1,rawCond=params.join(" "),currentCond=parser.fullArgs(),currentClause="",t=0,nesting=0,i=0;for(;i<src.length;i++){if((src.substr(i,6)=="<<else")&&!nesting){rawConds.push(rawCond);conditions.push(currentCond.trim());clauses.push(currentClause);currentClause="";t=src.indexOf(">>",i+6);if(src.substr(i+6,4)==" if "||src.substr(i+6,3)=="if "){rawCond=src.slice(i+9,t);currentCond=Wikifier.parse(rawCond)}else{rawCond="";currentCond="true"}i=t+2}if(src.substr(i,5)=="<<if "){nesting++
}if(src.substr(i,9)=="<<endif>>"){nesting--;if(nesting<0){endPos=srcOffset+i+9;rawConds.push(rawCond);conditions.push(currentCond.trim());clauses.push(currentClause);break}}currentClause+=src.charAt(i)}if(endPos!=-1){parser.nextMatch=endPos;try{for(i=0;i<clauses.length;i++){if(internalEval(conditions[i])){new Wikifier(place,clauses[i]);break}}}catch(e){throwError(place,"<<"+(i?"else ":"")+"if>> bad condition: "+rawConds[i],!i?parser.fullMatch():"<<else if "+rawConds[i]+">>")}}else{throwError(place,"I can't find a matching <<endif>>",parser.fullMatch())}}};macros["else"]=macros.elseif=macros.endif={handler:function(){}};version.extensions.rememberMacro={major:2,minor:0,revision:0};macros.remember={handler:function(place,macroName,params,parser){var variable,value,re,match,statement=params.join(" ");macros.set.run(place,parser.fullArgs(),null,params.join(" "));if(!window.localStorage){throwError(place,"<<remember>> can't be used "+(window.location.protocol=="file:"?" by local HTML files ":"")+" in this browser.",parser.fullMatch());return}re=new RegExp(Wikifier.textPrimitives.variable,"g");while(match=re.exec(statement)){variable=match[1];value=state.history[0].variables[variable];try{value=JSON.stringify(value)}catch(e){throwError(place,"can't <<remember>> the variable $"+variable+" ("+(typeof value)+")",parser.fullMatch());return}window.localStorage[this.prefix+variable]=value}},init:function(){var i,variable,value;if(tale.has("StoryTitle")){this.prefix="Twine."+tale.title+"."}else{this.prefix="Twine.Untitled Story."}for(i in window.localStorage){if(i.indexOf(this.prefix)==0){variable=i.substr(this.prefix.length);value=window.localStorage[i];try{value=JSON.parse(value);state.history[0].variables[variable]=value}catch(e){}}}},expire:null,prefix:null};version.extensions.forgetMacro={major:1,minor:0,revision:0};macros.forget={handler:function(place,macroName,params){var re,match,variable,statement=params.join(" ");re=new RegExp(Wikifier.textPrimitives.variable,"g");while(match=re.exec(statement)){variable=match[1]+"";delete state.history[0].variables[variable];delete window.localStorage[macros.remember.prefix+variable]}}};version.extensions.SilentlyMacro={major:1,minor:1,revision:0};macros.nobr=macros.silently={handler:function(place,macroName,f,parser){var i,h=insertElement(null,"div"),k=parser.source.indexOf(">>",parser.matchStart)+2,a=parser.source.slice(k),d=-1,c="",l=0;for(i=0;i<a.length;i++){if(a.substr(i,macroName.length+7)=="<<end"+macroName+">>"){if(l==0){d=k+i+macroName.length+7;break}else{l--
}}else{if(a.substr(i,macroName.length+4)=="<<"+macroName+">>"){l++
}}if(macroName=="nobr"&&a.charAt(i)=="\n"){c+="\u200c"}else{c+=a.charAt(i)}}if(d!=-1){new Wikifier(macroName=="nobr"?place:h,c);parser.nextMatch=d}else{throwError(place,"can't find matching <<end"+macroName+">>",parser.fullMatch())}}};macros.endsilently={handler:function(){}};version.extensions.choiceMacro={major:2,minor:0,revision:0};macros.choice={callback:function(){var i,other,passage=findPassageParent(this);if(passage){other=passage.querySelectorAll(".choice");for(i=0;i<other.length;i++){other[i].outerHTML="<span class=disabled>"+other[i].innerHTML+"</span>"}state.history[0].variables["choice clicked"][passage.id.replace(/\|[^\]]*$/,"")]=true}},handler:function(A,C,D,parser){var link,id,match,text=D[1]||D[0].split("|")[0],passage=findPassageParent(A);if(!passage){throwError(A,"<<"+C+">> can't be used here.",parser.fullMatch());return}id=(passage&&passage.id.replace(/\|[^\]]*$/,""));if(id&&(state.history[0].variables["choice clicked"]||(state.history[0].variables["choice clicked"]={}))[id]){insertElement(A,"span",null,"disabled",text)}else{match=new RegExp(Wikifier.linkFormatter.lookahead).exec(parser.fullMatch());if(match){link=Wikifier.linkFormatter.makeLink(A,match,this.callback)}else{link=Wikifier.linkFormatter.makeLink(A,[0,text,D[0]],this.callback)}link.className+=" "+C}}};version.extensions.backMacro={major:2,minor:0,revision:0};macros.back={labeltext:"&#171; back",handler:function(a,b,e,parser){var labelParam,c,el,labeltouse=this.labeltext,steps=1,stepsParam=e.indexOf("steps"),stepsParam2="";if(stepsParam>0){stepsParam2=e[stepsParam-1];if(stepsParam2[0]=="$"){try{stepsParam2=internalEval(Wikifier.parse(stepsParam2))}catch(r){throwError(a,parser.fullMatch()+" bad expression: "+r.message,parser.fullMatch());return}}steps=+stepsParam2;if(steps>=state.history.length-1){steps=state.history.length-2}e.splice(stepsParam-1,2)}labelParam=e.indexOf("label");if(labelParam>-1){if(!e[labelParam+1]){throwError(a,parser.fullMatch()+": "+e[labelParam]+" keyword needs an additional label parameter",parser.fullMatch());return}labeltouse=e[labelParam+1];e.splice(labelParam,2)}if(stepsParam<=0){if(e[0]){if(e[0].charAt(0)=="$"){try{e=internalEval(Wikifier.parse(e[0]))}catch(r){throwError(a,parser.fullMatch()+" bad expression: "+r.message,parser.fullMatch());return}}else{e=e[0]}if(!tale.has(e)){throwError(a,'The "'+e+'" passage does not exist',parser.fullMatch());return}for(c=0;c<state.history.length;c++){if(state.history[c].passage.title==e){steps=c;break}}}}el=document.createElement("a");el.className=b;addClickHandler(el,(function(b){return function(){return macros.back.onclick(b=="back",steps,el)}}(b)));el.innerHTML=labeltouse;a.appendChild(el)}};version.extensions.returnMacro={major:2,minor:0,revision:0};macros["return"]={labeltext:"&#171; return",handler:function(a,b,e){macros.back.handler.call(this,a,b,e)}};version.extensions.textInputMacro={major:2,minor:0,revision:0};macros.checkbox=macros.radio=macros.textinput={handler:function(A,C,D,parser){var match,class_=C.replace("input","Input"),q=A.querySelectorAll("input"),id=class_+"|"+((q&&q.length)||0);input=insertElement(null,"input",id,class_);input.name=D[0];input.type=C.replace("input","");A.appendChild(input);if(C=="textinput"&&D[1]){match=new RegExp(Wikifier.linkFormatter.lookahead).exec(parser.fullMatch());if(match){Wikifier.linkFormatter.makeLink(A,match,macros.button.callback,"button")}else{Wikifier.linkFormatter.makeLink(A,[0,(D[2]||D[1]),D[1]],macros.button.callback,"button")}}else{if((C=="radio"||C=="checkbox")&&D[1]){input.value=D[1];insertElement(A,"label","","",D[1]).setAttribute("for",id);if(D[2]){insertElement(A,"br");D.splice(1,1);macros[C].handler(A,C,D)}}}}};version.extensions.buttonMacro={major:1,minor:0,revision:0};macros.button={callback:function(){var el=findPassageParent(this);if(el){var inputs=el.querySelectorAll("input");for(i=0;i<inputs.length;i++){if(inputs[i].type!="checkbox"&&(inputs[i].type!="radio"||inputs[i].checked)){macros.set.run(null,Wikifier.parse(inputs[i].name+' = "'+inputs[i].value.replace(/"/g,'\\"')+'"'))}else{if(inputs[i].type=="checkbox"&&inputs[i].checked){macros.set.run(null,Wikifier.parse(inputs[i].name+" = [].concat("+inputs[i].name+" || []);"));macros.set.run(null,Wikifier.parse(inputs[i].name+'.push("'+inputs[i].value.replace(/"/g,'\\"')+'")'))}}}}},handler:function(A,C,D,parser){var link,match=new RegExp(Wikifier.linkFormatter.lookahead).exec(parser.fullMatch());if(match){Wikifier.linkFormatter.makeLink(A,match,this.callback,"button")}else{Wikifier.linkFormatter.makeLink(A,[0,D[1]||D[0],D[0]],this.callback,"button")}}};function Passage(c,b,a,ofunc){var t;if(!this||this.constructor!=Passage){throw new ReferenceError("passage() must be in lowercase")}this.title=c;ofunc=typeof ofunc=="function"&&ofunc;if(b){this.id=a;this.tags=b.getAttribute("tags");if(typeof this.tags=="string"){if(ofunc){this.tags=ofunc(this.tags)}this.tags=this.tags.readBracketedList()}else{this.tags=[]}t=b.firstChild?b.firstChild.nodeValue:"";if(ofunc&&!this.isImage()){this.text=ofunc(Passage.unescapeLineBreaks(t))}else{this.text=Passage.unescapeLineBreaks(t)}if(!this.isImage()){this.preloadImages()}if(/\.char\b|\[data\-char\b/.exec(this.text)&&Wikifier.charSpanFormatter){Wikifier.formatters.push(Wikifier.charSpanFormatter);delete Wikifier.charSpanFormatter}}else{this.text="@@This passage does not exist: "+c+"@@";this.tags=[]}}Passage.prototype.isImage=function(){return !!~(this.tags.indexOf("Twine.image"))};Passage.prototype.preloadImages=function(){var u="\\s*['\"]?([^\"'$]+\\.(jpe?g|a?png|gif|bmp|webp|svg))['\"]?\\s*",k=function(c,e){var i,d;do{d=c.exec(this.text);if(d){i=new Image();i.src=d[e]}}while(d);return k};k.call(this,new RegExp(Wikifier.imageFormatter.lookahead.replace("[^\\[\\]\\|]+",u),"mg"),4).call(this,new RegExp("url\\s*\\("+u+"\\)","mig"),1).call(this,new RegExp("src\\s*="+u,"mig"),1)};Passage.unescapeLineBreaks=function(a){if(a&&typeof a=="string"){return a.replace(/\\n/mg,"\n").replace(/\\t/mg,"\t").replace(/\\s/mg,"\\").replace(/\\/mg,"\\").replace(/\r/mg,"")}else{return""
}};Passage.prototype.setTags=function(b){var t=this.tags!=null&&this.tags.length?this.tags.join(" "):"";if(t){b.setAttribute("data-tags",this.tags.join(" "))}document.body.setAttribute("data-tags",t)};Passage.prototype.processText=function(){var ret=this.text;if(~this.tags.indexOf("nobr")){ret=ret.replace(/\n/g,"\u200c")}if(this.isImage()){ret="[img["+ret+"]]"}return ret};function Tale(){var a,b,c,lines,i,kv,nsc,isImage,settings=this.storysettings={lookup:function(a,dfault){if(!(a in this)){return dfault
}return(this[a]+"")!="off"}},tiddlerTitle="";window.tale=this;this.passages={};if(document.normalize){document.normalize()}a=document.getElementById("storeArea").children;for(b=0;b<a.length;b++){c=a[b];if(c.getAttribute&&c.getAttribute("tiddler")=="StorySettings"){lines=new Passage("StorySettings",c,0,null,null).text.split("\n");for(i in lines){if(typeof lines[i]=="string"&&lines[i].indexOf(":")>-1){kv=lines[i].toLowerCase().split(":");kv[0]=kv[0].replace(/^\s+|\s+$/g,"");kv[1]=kv[1].replace(/^\s+|\s+$/g,"");if(kv[0]!="lookup"){settings[kv[0]]=kv[1]}}}}}if(settings.obfuscate=="rot13"){for(b=0;b<a.length;b++){c=a[b];if(c.getAttribute&&(tiddlerTitle=c.getAttribute("tiddler"))){isImage=(c.getAttribute("tags")+"").indexOf("Twine.image")>-1;if(tiddlerTitle!="StorySettings"&&!isImage){tiddlerTitle=rot13(tiddlerTitle)}this.passages[tiddlerTitle]=new Passage(tiddlerTitle,c,b+1,!isImage&&rot13)
}}}else{for(b=0;b<a.length;b++){c=a[b];if(c.getAttribute&&(tiddlerTitle=c.getAttribute("tiddler"))){this.passages[tiddlerTitle]=new Passage(tiddlerTitle,c,b,null,null)}}}}Tale.prototype.has=function(a){if(typeof a=="string"){return(this.passages[a]!=null)}else{for(var i in this.passages){if(this.passages[i].id==a){return true
}}return false}};Tale.prototype.get=function(a){if(typeof a=="string"){return this.passages[a]||new Passage(a)}else{for(var i in this.passages){if(this.passages[i].id==a){return this.passages[i]}}}};Tale.prototype.lookup=function(h,g,a){var d=[];for(var c in this.passages){var f=this.passages[c];for(var b=0;b<f[h].length;b++){if(f[h][b]==g){d.push(f)}}}if(!a){a="title"
}d.sort(function(k,j){if(k[a]==j[a]){return(0)}else{return(k[a]<j[a])?-1:+1}});return d};Tale.prototype.canUndo=function(){return this.storysettings.lookup("undo",true)};Tale.prototype.identity=function(){var meta=document.querySelector("meta[name='identity']"),identity=meta?meta.getAttribute("content"):"story";return(Tale.prototype.identity=function(){return identity
})()};Tale.prototype.forEachStylesheet=function(tags,callback){var passage,i;tags=tags||[];if(typeof callback!="function"){return
}for(passage in this.passages){passage=tale.passages[passage];if(passage&&~passage.tags.indexOf("stylesheet")){for(i=0;i<tags.length;i++){if(~passage.tags.indexOf(tags[i])){callback(passage);break}}}}};Tale.prototype.setPageElements=function(){var storyTitle,defaultTitle="twine1-4version";setPageElement("storyTitle","StoryTitle",defaultTitle);storyTitle=document.getElementById("storyTitle");document.title=this.title=(storyTitle&&(storyTitle.textContent||storyTitle.innerText))||defaultTitle;setPageElement("storySubtitle","StorySubtitle","");if(tale.has("StoryAuthor")){setPageElement("titleSeparator",null,"\n");setPageElement("storyAuthor","StoryAuthor","")}if(tale.has("StoryMenu")){document.getElementById("storyMenu").setAttribute("style","");setPageElement("storyMenu","StoryMenu","")}};function Wikifier(place,source){this.source=source;this.output=place;this.nextMatch=0;this.assembleFormatterMatches(Wikifier.formatters);this.subWikify(this.output)}Wikifier.textPrimitives={upperLetter:"[A-Z\u00c0-\u00de\u0150\u0170]",lowerLetter:"[a-z\u00df-\u00ff_0-9\\-\u0151\u0171]",anyLetter:"[A-Za-z\u00c0-\u00de\u00df-\u00ff_0-9\\-\u0150\u0170\u0151\u0171]"};Wikifier.textPrimitives.variable="\\$((?:"+Wikifier.textPrimitives.anyLetter.replace("\\-","")+"*"+Wikifier.textPrimitives.anyLetter.replace("0-9\\-","")+"+"+Wikifier.textPrimitives.anyLetter.replace("\\-","")+"*)+)";Wikifier.textPrimitives.unquoted="(?=(?:[^\"'\\\\]*(?:\\\\.|'(?:[^'\\\\]*\\\\.)*[^'\\\\]*'|\"(?:[^\"\\\\]*\\\\.)*[^\"\\\\]*\"))*[^'\"]*$)";Wikifier.prototype.assembleFormatterMatches=function(formatters){this.formatters=[];var pattern=[];for(var n=0;n<formatters.length;n++){pattern.push("("+formatters[n].match+")");this.formatters.push(formatters[n])}this.formatterRegExp=new RegExp(pattern.join("|"),"mg")};Wikifier.prototype.subWikify=function(output,terminator){var terminatorMatch,formatterMatch,oldOutput=this.output;this.output=output;var terminatorRegExp=terminator?new RegExp("("+terminator+")","mg"):null;do{this.formatterRegExp.lastIndex=this.nextMatch;if(terminatorRegExp){terminatorRegExp.lastIndex=this.nextMatch}formatterMatch=this.formatterRegExp.exec(this.source);terminatorMatch=terminatorRegExp?terminatorRegExp.exec(this.source):null;if(terminatorMatch&&(!formatterMatch||terminatorMatch.index<=formatterMatch.index)){if(terminatorMatch.index>this.nextMatch){this.outputText(this.output,this.nextMatch,terminatorMatch.index)}this.matchStart=terminatorMatch.index;this.matchLength=terminatorMatch[1].length;this.matchText=terminatorMatch[1];this.nextMatch=terminatorMatch.index+terminatorMatch[1].length;this.output=oldOutput;return}else{if(formatterMatch){if(formatterMatch.index>this.nextMatch){this.outputText(this.output,this.nextMatch,formatterMatch.index)}this.matchStart=formatterMatch.index;this.matchLength=formatterMatch[0].length;this.matchText=formatterMatch[0];this.nextMatch=this.formatterRegExp.lastIndex;var matchingFormatter=-1;for(var t=1;t<formatterMatch.length;t++){if(formatterMatch[t]){matchingFormatter=t-1;break}}if(matchingFormatter!=-1){this.formatters[matchingFormatter].handler(this)}}}}while(terminatorMatch||formatterMatch);if(this.nextMatch<this.source.length){this.outputText(this.output,this.nextMatch,this.source.length);this.nextMatch=this.source.length}this.output=oldOutput};Wikifier.prototype.outputText=function(place,startPos,endPos){if(place){insertText(place,this.source.substring(startPos,endPos))}};Wikifier.prototype.fullMatch=function(){return this.source.slice(this.matchStart,this.source.indexOf(">>",this.matchStart)+2)};Wikifier.prototype.fullArgs=function(includeName){var source=this.source.replace(/\u200c/g," "),endPos=this.nextMatch-2,startPos=source.indexOf(includeName?"<<":" ",this.matchStart);if(!~startPos||!~endPos||endPos<=startPos){return""
}return Wikifier.parse(source.slice(startPos+(includeName?2:1),endPos).trim())};Wikifier.parse=function(input){var m,re,b=input,found=[],g=Wikifier.textPrimitives.unquoted;function alter(from,to){b=b.replace(new RegExp(from+g,"gim"),to);return alter}re=new RegExp(Wikifier.textPrimitives.variable+g,"gi");while(m=re.exec(input)){if(!~found.indexOf(m[0])){b=m[0]+" == null && ("+m[0]+" = 0);"+b;found.push(m[0])}}alter(Wikifier.textPrimitives.variable,"state.history[0].variables.$1")("\\beq\\b"," == ")("\\bneq\\b"," != ")("\\bgt\\b"," > ")("\\bgte\\b"," >= ")("\\blt\\b"," < ")("\\blte\\b"," <= ")("\\band\\b"," && ")("\\bor\\b"," || ")("\\bnot\\b"," ! ")("\\bis\\b"," == ")("\\bto\\b"," = ");return b};Wikifier.formatHelpers={charFormatHelper:function(a){var b=insertElement(a.output,this.element);a.subWikify(b,this.terminator)},inlineCssHelper:function(w){var s,v,lookaheadMatch,gotMatch,styles=[],lookahead=Wikifier.styleByCharFormatter.lookahead,lookaheadRegExp=new RegExp(lookahead,"mg"),hadStyle=false,unDash=function(str){var s=str.split("-");if(s.length>1){for(var t=1;t<s.length;t++){s[t]=s[t].substr(0,1).toUpperCase()+s[t].substr(1)}}return s.join("")};styles.className="";do{lookaheadRegExp.lastIndex=w.nextMatch;lookaheadMatch=lookaheadRegExp.exec(w.source);gotMatch=lookaheadMatch&&lookaheadMatch.index==w.nextMatch;if(gotMatch){hadStyle=true;if(lookaheadMatch[5]){styles.className+=lookaheadMatch[5].replace(/\./g," ")+" "}else{if(lookaheadMatch[1]){s=unDash(lookaheadMatch[1]);v=lookaheadMatch[2]}else{s=unDash(lookaheadMatch[3]);v=lookaheadMatch[4]}}switch(s){case"bgcolor":s="backgroundColor";break;case"float":s="cssFloat";break}styles.push({style:s,value:v});w.nextMatch=lookaheadMatch.index+lookaheadMatch[0].length}}while(gotMatch);return styles},monospacedByLineHelper:function(w){var lookaheadRegExp=new RegExp(this.lookahead,"mg");lookaheadRegExp.lastIndex=w.matchStart;var lookaheadMatch=lookaheadRegExp.exec(w.source);if(lookaheadMatch&&lookaheadMatch.index==w.matchStart){insertElement(w.output,"pre",null,null,lookaheadMatch[1]);w.nextMatch=lookaheadMatch.index+lookaheadMatch[0].length}}};Wikifier.formatters=[{name:"table",match:"^\\|(?:[^\\n]*)\\|(?:[fhc]?)$",lookahead:"^\\|([^\\n]*)\\|([fhc]?)$",rowTerminator:"\\|(?:[fhc]?)$\\n?",cellPattern:"(?:\\|([^\\n\\|]*)\\|)|(\\|[fhc]?$\\n?)",cellTerminator:"(?:\\x20*)\\|",rowTypes:{"c":"caption","h":"thead","":"tbody","f":"tfoot"},handler:function(w){var rowContainer,rowElement,lookaheadMatch,matched,table=insertElement(w.output,"table"),lookaheadRegExp=new RegExp(this.lookahead,"mg"),currRowType=null,nextRowType,prevColumns=[],rowCount=0;w.nextMatch=w.matchStart;do{lookaheadRegExp.lastIndex=w.nextMatch;lookaheadMatch=lookaheadRegExp.exec(w.source),matched=lookaheadMatch&&lookaheadMatch.index==w.nextMatch;if(matched){nextRowType=lookaheadMatch[2];if(nextRowType!=currRowType){rowContainer=insertElement(table,this.rowTypes[nextRowType])}currRowType=nextRowType;if(currRowType=="c"){if(rowCount==0){rowContainer.setAttribute("align","top")}else{rowContainer.setAttribute("align","bottom")}w.nextMatch=w.nextMatch+1;w.subWikify(rowContainer,this.rowTerminator)}else{rowElement=insertElement(rowContainer,"tr");this.rowHandler(w,rowElement,prevColumns)}rowCount++}}while(matched)},rowHandler:function(w,e,prevColumns){var cellMatch,matched,col=0,currColCount=1,cellRegExp=new RegExp(this.cellPattern,"mg");do{cellRegExp.lastIndex=w.nextMatch;cellMatch=cellRegExp.exec(w.source);matched=cellMatch&&cellMatch.index==w.nextMatch;if(matched){if(cellMatch[1]=="~"){var last=prevColumns[col];if(last){last.rowCount++;last.element.setAttribute("rowSpan",last.rowCount);last.element.setAttribute("rowspan",last.rowCount);last.element.valign="center"}w.nextMatch=cellMatch.index+cellMatch[0].length-1}else{if(cellMatch[1]==">"){currColCount++;w.nextMatch=cellMatch.index+cellMatch[0].length-1}else{if(cellMatch[2]){w.nextMatch=cellMatch.index+cellMatch[0].length;break}else{var spaceLeft=false,spaceRight=false,lastColCount,lastColElement,styles,cell,t;w.nextMatch++;styles=Wikifier.formatHelpers.inlineCssHelper(w);while(w.source.substr(w.nextMatch,1)==" "){spaceLeft=true;w.nextMatch++}if(w.source.substr(w.nextMatch,1)=="!"){cell=insertElement(e,"th");w.nextMatch++}else{cell=insertElement(e,"td")}prevColumns[col]={rowCount:1,element:cell};lastColCount=1;lastColElement=cell;if(currColCount>1){cell.setAttribute("colSpan",currColCount);cell.setAttribute("colspan",currColCount);currColCount=1}for(t=0;t<styles.length;t++){cell.style[styles[t].style]=styles[t].value}w.subWikify(cell,this.cellTerminator);if(w.matchText.substr(w.matchText.length-2,1)==" "){spaceRight=true
}if(spaceLeft&&spaceRight){cell.align="center"}else{if(spaceLeft){cell.align="right"}else{if(spaceRight){cell.align="left"}}}w.nextMatch=w.nextMatch-1}}}col++}}while(matched)}},{name:"rule",match:"^----$\\n?",handler:function(w){insertElement(w.output,"hr")}},{name:"emdash",match:"--",becomes:String.fromCharCode(8212),handler:function(a){insertElement(a.output,"span",null,"char",this.becomes).setAttribute("data-char","emdash")}},{name:"heading",match:"^!{1,5}",terminator:"\\n",handler:function(w){var e=insertElement(w.output,"h"+w.matchLength);w.subWikify(e,this.terminator)}},{name:"monospacedByLine",match:"^\\{\\{\\{\\n",lookahead:"^\\{\\{\\{\\n((?:^[^\\n]*\\n)+?)(^\\}\\}\\}$\\n?)",handler:Wikifier.formatHelpers.monospacedByLineHelper},{name:"quoteByBlock",match:"^<<<\\n",terminator:"^<<<\\n",handler:function(w){var e=insertElement(w.output,"blockquote");w.subWikify(e,this.terminator)}},{name:"list",match:"^(?:(?:\\*+)|(?:#+))",lookahead:"^(?:(\\*+)|(#+))",terminator:"\\n",handler:function(w){var newType,newLevel,t,len,bulletType,lookaheadMatch,matched,lookaheadRegExp=new RegExp(this.lookahead,"mg"),placeStack=[w.output],currType=null,currLevel=0;w.nextMatch=w.matchStart;do{lookaheadRegExp.lastIndex=w.nextMatch;lookaheadMatch=lookaheadRegExp.exec(w.source);matched=lookaheadMatch&&lookaheadMatch.index==w.nextMatch;if(matched){newLevel=lookaheadMatch[0].length;if(lookaheadMatch[1]){bulletType=lookaheadMatch[1].slice(-1);newType="ul"}else{if(lookaheadMatch[2]){newType="ol"
}}w.nextMatch+=newLevel;if(newLevel>currLevel){for(t=currLevel;t<newLevel;t++){placeStack.push(insertElement(placeStack[placeStack.length-1],newType))}}else{if(newLevel<currLevel){for(t=currLevel;t>newLevel;t--){placeStack.pop()}}else{if(newLevel==currLevel&&newType!=currType){placeStack.pop();placeStack.push(insertElement(placeStack[placeStack.length-1],newType))}}}currLevel=newLevel;currType=newType;t=insertElement(placeStack[placeStack.length-1],"li");if(bulletType&&bulletType!="*"){t.setAttribute("data-bullet",bulletType)}w.subWikify(t,this.terminator)}}while(matched)}},(Wikifier.urlFormatter={name:"urlLink",match:"(?:https?|mailto|javascript|ftp|data):[^\\s'\"]+(?:/|\\b)",handler:function(w){var e=Wikifier.createExternalLink(w.output,w.matchText);w.outputText(e,w.matchStart,w.nextMatch)}}),(Wikifier.linkFormatter={name:"prettyLink",match:"\\[\\[",lookahead:"\\[\\[([^\\|]*?)(?:\\|(.*?))?\\](?:\\[(.*?)])?\\]",makeInternalOrExternal:function(out,title,callback,type){if(title&&!tale.has(title)&&(title.match(Wikifier.urlFormatter.match,"g")||~title.search(/[\.\\\/#]/))){return Wikifier.createExternalLink(out,title,callback,type)
}else{return Wikifier.createInternalLink(out,title,callback,type)}},makeCallback:function(code,callback){return function(){macros.set.run(null,Wikifier.parse(code),null,code);typeof callback=="function"&&callback.call(this)}},makeLink:function(out,match,callback2,type){var link,title,callback;if(match[3]){callback=this.makeCallback(match[3],callback2)}else{typeof callback2=="function"&&(callback=callback2)}title=Wikifier.parsePassageTitle(match[2]||match[1]);link=this.makeInternalOrExternal(out,title,callback,type);setPageElement(link,null,match[2]?match[1]:title);return link},handler:function(w){var lookaheadRegExp=new RegExp(this.lookahead,"mg");lookaheadRegExp.lastIndex=w.matchStart;var lookaheadMatch=lookaheadRegExp.exec(w.source);if(lookaheadMatch&&lookaheadMatch.index==w.matchStart){this.makeLink(w.output,lookaheadMatch);w.nextMatch=lookaheadMatch.index+lookaheadMatch[0].length}}}),(Wikifier.imageFormatter={name:"image",match:"\\[(?:[<]{0,1})(?:[>]{0,1})[Ii][Mm][Gg]\\[",lookahead:"\\[([<]?)(>?)img\\[(?:([^\\|\\]]+)\\|)?([^\\[\\]\\|]+)\\](?:\\[([^\\]]*)\\]?)?(\\])",importedImage:function(img,passageName){var imgPassages,imgname;try{imgname=internalEval(Wikifier.parse(passageName))}catch(e){}if(!imgname){imgname=passageName
}imgPassages=tale.lookup("tags","Twine.image");for(j=0;j<imgPassages.length;j++){if(imgPassages[j].title==imgname){img.src=imgPassages[j].text;break}}},handler:function(w){var e,img,j,lookaheadMatch,lookaheadRegExp=new RegExp(this.lookahead,"mig");lookaheadRegExp.lastIndex=w.matchStart;lookaheadMatch=lookaheadRegExp.exec(w.source);if(lookaheadMatch&&lookaheadMatch.index==w.matchStart){e=w.output,title=Wikifier.parsePassageTitle(lookaheadMatch[5]);if(title){e=Wikifier.linkFormatter.makeInternalOrExternal(w.output,title)}img=insertElement(e,"img");if(lookaheadMatch[1]){img.align="left"}else{if(lookaheadMatch[2]){img.align="right"}}if(lookaheadMatch[3]){img.title=lookaheadMatch[3]}this.importedImage(img,lookaheadMatch[4]);w.nextMatch=lookaheadMatch.index+lookaheadMatch[0].length}}}),{name:"macro",match:"<<",lookahead:/<<([^>\s]+)(?:\s*)((?:\\.|'(?:[^'\\]*\\.)*[^'\\]*'|"(?:[^"\\]*\\.)*[^"\\]*"|[^'"\\>]|>(?!>))*)>>/mg,handler:function(w){var lookaheadRegExp=new RegExp(this.lookahead);lookaheadRegExp.lastIndex=w.matchStart;var lookaheadMatch=lookaheadRegExp.exec(w.source.replace(/\u200c/g,"\n"));if(lookaheadMatch&&lookaheadMatch.index==w.matchStart&&lookaheadMatch[1]){var params=lookaheadMatch[2].readMacroParams();w.nextMatch=lookaheadMatch.index+lookaheadMatch[0].length;var name=lookaheadMatch[1];try{var macro=macros[name];if(macro&&typeof macro=="object"&&macro.handler){macro.handler(w.output,name,params,w)}else{if(name[0]=="$"){macros.print.handler(w.output,name,[name].concat(params),w)}else{if(tale.has(name)){macros.display.handler(w.output,name,[name].concat(params),w)}else{throwError(w.output,'No macro or passage called "'+name+'"',w.fullMatch())}}}}catch(e){throwError(w.output,"Error executing macro "+name+": "+e.toString(),w.fullMatch())}}}},{name:"html",match:"<html>",lookahead:"<html>((?:.|\\n)*?)</html>",handler:function(w){var lookaheadRegExp=new RegExp(this.lookahead,"mg");lookaheadRegExp.lastIndex=w.matchStart;var lookaheadMatch=lookaheadRegExp.exec(w.source);if(lookaheadMatch&&lookaheadMatch.index==w.matchStart){var e=insertElement(w.output,"span");e.innerHTML=lookaheadMatch[1];w.nextMatch=lookaheadMatch.index+lookaheadMatch[0].length}}},{name:"commentByBlock",match:"/%",lookahead:"/%((?:.|\\n)*?)%/",handler:function(w){var lookaheadRegExp=new RegExp(this.lookahead,"mg");lookaheadRegExp.lastIndex=w.matchStart;var lookaheadMatch=lookaheadRegExp.exec(w.source);if(lookaheadMatch&&lookaheadMatch.index==w.matchStart){w.nextMatch=lookaheadMatch.index+lookaheadMatch[0].length}}},{name:"boldByChar",match:"''",terminator:"''",element:"strong",handler:Wikifier.formatHelpers.charFormatHelper},{name:"strikeByChar",match:"==",terminator:"==",element:"strike",handler:Wikifier.formatHelpers.charFormatHelper},{name:"underlineByChar",match:"__",terminator:"__",element:"u",handler:Wikifier.formatHelpers.charFormatHelper},{name:"italicByChar",match:"//",terminator:"//",element:"em",handler:Wikifier.formatHelpers.charFormatHelper},{name:"subscriptByChar",match:"~~",terminator:"~~",element:"sub",handler:Wikifier.formatHelpers.charFormatHelper},{name:"superscriptByChar",match:"\\^\\^",terminator:"\\^\\^",element:"sup",handler:Wikifier.formatHelpers.charFormatHelper},{name:"monospacedByChar",match:"\\{\\{\\{",lookahead:"\\{\\{\\{((?:.|\\n)*?)\\}\\}\\}",handler:function(w){var lookaheadRegExp=new RegExp(this.lookahead,"mg");lookaheadRegExp.lastIndex=w.matchStart;var lookaheadMatch=lookaheadRegExp.exec(w.source);if(lookaheadMatch&&lookaheadMatch.index==w.matchStart){var e=insertElement(w.output,"code",null,null,lookaheadMatch[1]);w.nextMatch=lookaheadMatch.index+lookaheadMatch[0].length}}},(Wikifier.styleByCharFormatter={name:"styleByChar",match:"@@",terminator:"@@",lookahead:"(?:([^\\(@]+)\\(([^\\)\\|\\n]+)(?:\\):))|(?:([^\\.:@]+):([^;\\|\\n]+);)|(?:\\.([^;\\|\\n]+);)",handler:function(w){var e=insertElement(w.output,"span",null,null,null);var styles=Wikifier.formatHelpers.inlineCssHelper(w);if(styles.length==0){e.className="marked"}else{for(var t=0;t<styles.length;t++){e.style[styles[t].style]=styles[t].value}if(typeof styles.className=="string"){e.className=styles.className}}w.subWikify(e,this.terminator)}}),{name:"lineBreak",match:"\\n",handler:function(w){insertElement(w.output,"br")}},{name:"continuedLine",match:"\\\\\\s*?\\n",handler:function(a){a.nextMatch=a.matchStart+2}},{name:"htmlCharacterReference",match:"(?:(?:&#?[a-zA-Z0-9]{2,8};|.)(?:&#?(?:x0*(?:3[0-6][0-9a-fA-F]|1D[c-fC-F][0-9a-fA-F]|20[d-fD-F][0-9a-fA-F]|FE2[0-9a-fA-F])|0*(?:76[89]|7[7-9][0-9]|8[0-7][0-9]|761[6-9]|76[2-7][0-9]|84[0-3][0-9]|844[0-7]|6505[6-9]|6506[0-9]|6507[0-1]));)+|&#?[a-zA-Z0-9]{2,8};)",handler:function(w){var el=document.createElement("div");el.innerHTML=w.matchText;insertText(w.output,el.textContent)}},{name:"htmltag",match:"<(?:\\/?[\\w\\-]+|[\\w\\-]+(?:(?:\\s+[\\w\\-]+(?:\\s*=\\s*(?:\\\".*?\\\"|'.*?'|[^'\\\">\\s]+))?)+\\s*|\\s*)\\/?)>",tagname:"<(\\w+)",voids:["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"],tableElems:["table","thead","tbody","tfoot","th","tr","td","colgroup","col","caption","figcaption"],cleanupTables:function(e){var i,name,elems=[].slice.call(e.children);for(i=0;i<elems.length;i++){if(elems[i].tagName){name=elems[i].tagName.toLowerCase();if(this.tableElems.indexOf(name)==-1){elems[i].outerHTML=""}else{if(["col","caption","figcaption","td","th"].indexOf(name)==-1){this.cleanupTables.call(this,elems[i])}}}}},handler:function(a){var tmp,passage,setter,e,isvoid,isstyle,lookaheadRegExp,lookaheadMatch,lookahead,re=new RegExp(this.tagname).exec(a.matchText),tn=re&&re[1]&&re[1].toLowerCase();if(tn&&tn!="html"){lookahead="<\\/\\s*"+tn+"\\s*>";isvoid=(this.voids.indexOf(tn)!=-1);isstyle=tn=="style"||tn=="script";lookaheadRegExp=new RegExp(lookahead,"mg");lookaheadRegExp.lastIndex=a.matchStart;lookaheadMatch=lookaheadRegExp.exec(a.source);if(lookaheadMatch||isvoid){if(isstyle){e=document.createElement(tn);e.type="text/css";tmp=a.source.slice(a.nextMatch,lookaheadMatch.index);e.styleSheet?(e.styleSheet.cssText=tmp):(e.innerHTML=tmp);a.nextMatch=lookaheadMatch.index+lookaheadMatch[0].length}else{e=document.createElement(a.output.tagName);e.innerHTML=a.matchText;while(e.firstChild){e=e.firstChild}if(!isvoid){a.subWikify(e,lookahead)}}if(e.tagName.toLowerCase()=="table"){this.cleanupTables.call(this,e)}if(setter=e.getAttribute("data-setter")){setter=Wikifier.linkFormatter.makeCallback(setter)}if(passage=e.getAttribute("data-passage")){if(tn!="img"){addClickHandler(e,Wikifier.linkFunction(Wikifier.parsePassageTitle(passage),e,setter));if(tn=="area"||tn=="a"){e.setAttribute("href","javascript:;")}}else{Wikifier.imageFormatter.importedImage(e,passage)}}a.output.appendChild(e)}else{throwError(a.output,"HTML tag '"+tn+"' wasn't closed.",a.matchText)}}}}];Wikifier.charSpanFormatter={name:"char",match:"[^\n]",handler:function(a){insertElement(a.output,"span",null,"char",a.matchText).setAttribute("data-char",a.matchText==" "?"space":a.matchText=="\t"?"tab":a.matchText)}};Wikifier.parsePassageTitle=function(title){if(title&&!tale.has(title)){try{title=(internalEval(this.parse(title))||title)+""}catch(e){}}return title};Wikifier.linkFunction=function(title,el,callback){return function(){if(state.rewindTo){var passage=findPassageParent(el);if(passage&&passage.parentNode.lastChild!=passage){state.rewindTo(passage,true)}}state.display(title,el,null,callback)}};Wikifier.createInternalLink=function(place,title,callback,type){var tag=(type=="button"?"button":"a"),suffix=(type=="button"?"Button":"Link"),el=insertElement(place,tag);if(tale.has(title)){el.className="internal"+suffix;if(visited(title)){el.className+=" visited"+suffix}}else{el.className="broken"+suffix}addClickHandler(el,Wikifier.linkFunction(title,el,callback));if(place){place.appendChild(el)}return el};Wikifier.createExternalLink=function(place,url,callback,type){var tag=(type=="button"?"button":"a"),el=insertElement(place,tag);el.href=url;el.className="external"+(type=="button"?"Button":"Link");el.target="_blank";if(typeof callback=="function"){addClickHandler(el,callback)}if(place){place.appendChild(el)}return el};function visited(e){var ret=0,i=0;if(!state){return 0
}e=e||state.history[0].passage.title;if(arguments.length>1){for(ret=state.history.length;i<arguments.length;i++){ret=Math.min(ret,visited(arguments[i]))}}else{for(;i<state.history.length&&state.history[i].passage;i++){if(e==state.history[i].passage.title){ret++
}}}return ret}function visitedTag(){var i,j,sh,ret=0,tags=Array.prototype.slice.call(arguments);if(tags.length==1&&typeof tags[0]=="string"){tags=tags.split(" ")}if(!state){return 0
}sh=state.history;for(i=0;i<sh.length&&sh[i].passage;i++){for(j=0;j<tags.length||void ret++;j++){if(sh[i].passage.tags.indexOf(tags[j])==-1){break
}}}return ret}var visitedTags=visitedTag;function turns(){return state.history.length-1}function passage(){return state.history[0].passage.title}function tags(e){var ret=[],i=0;if(!state){return 0
}e=e||state.history[0].passage.title;if(arguments.length>1){for(i=arguments.length-1;i>=1;i--){ret=ret.concat(tags(arguments[i]))}}ret=ret.concat(tale.get(e).tags);return ret}function previous(){if(state&&state.history[1]){for(var d=1;d<state.history.length&&state.history[d].passage;d++){if(state.history[d].passage.title!=state.history[0].passage.title){return state.history[d].passage.title}}}return""}function random(a,b){var from,to;if(!b){from=0;to=a}else{from=Math.min(a,b);to=Math.max(a,b)}to+=1;return ~~((Math.random()*(to-from)))+from}function either(){if(Array.isArray(arguments[0])&&arguments.length==1){return either.apply(this,arguments[0])}return arguments[~~(Math.random()*arguments.length)]}function parameter(n){n=n||0;if(macros.display.parameters[n]){return macros.display.parameters[n]}return 0}function bookmark(){return state.hash||"#"}function internalEval(s){return eval("0,"+s)}function scriptEval(s){try{eval(s.text)}catch(e){alert("There is a technical problem with this "+tale.identity()+" ("+s.title+": "+e.message+")."+softErrorMessage)}}window.onbeforeunload=function(){if(tale&&tale.storysettings.lookup("exitprompt",false)&&state&&state.history.length>1){return"You are about to end this "+tale.identity()+"."}};var oldOnError=window.onerror||null,softErrorMessage="You may be able to continue playing, but some parts may not work properly.";window.onerror=function(msg,a,b,c,error){var s=(error&&(".\n\n"+error.stack.replace(/\([^\)]+\)/g,"")+"\n\n"))||(" ("+msg+").\n");alert("Sorry to interrupt, but this "+((tale&&tale.identity&&tale.identity())||"page")+"'s code has got itself in a mess"+s+softErrorMessage.slice(1));window.onerror=oldOnError;if(typeof window.onerror=="function"){window.onerror(msg,a,b,c,error)}};var $;function main(){$=window.$||function(a){return(typeof a=="string"?document.getElementById(a):a)
};var imgs,scripts,macro,style,i,styleText="",passages=document.getElementById("passages");function sanityCheck(thing){var i,j,s="NOTE: The "+thing,checks={prerender:prerender,postrender:postrender,macros:macros};for(i in checks){if(Object.prototype.hasOwnProperty.call(checks,i)&&!sanityCheck[i]){if(!checks[i]||typeof checks[i]!="object"){alert(s+" seems to have corrupted the "+i+" object."+softErrorMessage);sanityCheck[i]=true;continue}if(i!="macros"){for(j in checks[i]){if(Object.prototype.hasOwnProperty.call(checks[i],j)&&typeof checks[i][j]!="function"){alert(s+" added a property '"+j+"' to "+i+", "+"which is a "+typeof checks[i][j]+", not a function."+softErrorMessage);sanityCheck[i]=true;break}}}}}if(!sanityCheck.display){if(History.prototype.display.length<4&&!~History.prototype.display.toString().indexOf("arguments")){alert(s+" contains a function that patches History.prototype.display, but takes the wrong number of arguments."+softErrorMessage)}sanityCheck.display=true}}if(!window.JSON||!document.querySelector){return(passages.innerHTML="This "+tale.identity()+" requires a newer web browser. Sorry.")}else{passages.innerHTML=""}tale=window.tale=new Tale();if(~document.documentElement.className.indexOf("lt-ie9")){imgs=tale.lookup("tags","Twine.image");for(i=0;i<imgs.length;i++){if(imgs[i].text.length>=32768){alert("NOTE: This "+tale.identity()+"'s HTML file contains embedded images that may be too large for this browser to display."+softErrorMessage);break}}}scripts=tale.lookup("tags","script");for(i=0;i<scripts.length;i++){scriptEval(scripts[i]);sanityCheck('script passage "'+scripts[i].title+'"')}state=window.state=new History();for(i in macros){macro=macros[i];if(typeof macro.init=="function"){macro.init();sanityCheck('init() of the custom macro "'+i+'"')}}style=document.getElementById("storyCSS");for(i in tale.passages){i=tale.passages[i];if(i.tags.indexOf("stylesheet")==-1){continue
}if(i.tags+""=="stylesheet"){styleText+=i.text}else{if(i.tags.length==2&&i.tags.indexOf("transition")>-1){setTransitionCSS(i.text)}}}styleText=alterCSS(styleText);style.styleSheet?(style.styleSheet.cssText=styleText):(style.innerHTML=styleText);state.init()}setTimeout(function f(){var size,bar=document.getElementById("loadingbar"),store=document.getElementById("storeArea");if(!bar){return
}if(store){size=store.getAttribute("data-size");if(store.children.length<=size&&!tale){bar.style.width=~~((store.children.length+1)/size*100)+"%"}else{bar.outerHTML="";return}}setTimeout(f,5)},5);

Tale.prototype.canBookmark=function(){return this.canUndo()&&(this.storysettings.lookup("bookmark",true))};History.prototype.init=function(){if(!this.restore()){if(tale.has("StoryInit")){new Wikifier(insertElement(null,"span"),tale.get("StoryInit").text)}this.display("Start",null,"quietly");tale.setPageElements()}};History.prototype.closeLinks=function(){var i,p,D,l=document.querySelectorAll("#passages .internalLink");for(i=l.length-1;i>=0;i--){D=insertElement(null,"span",null,"disabled");D.innerHTML=l[i].innerHTML;p=l[i].parentNode;p.insertBefore(D,l[i].nextSibling);p.removeChild(l[i])}l=document.querySelectorAll(".toolbar");for(i=l.length-1;i>=0;i--){l[i].parentNode.removeChild(l[i])}};History.prototype.replaceURL=function(){if(tale.storysettings.lookup("hash")&&window.history&&typeof window.history.replaceState=="function"){window.history.replaceState({id:this.id,length:this.history.length},document.title,this.hash)}};History.prototype.display=function(name,source,type,callback){var el,D,F,p=document.getElementById("passages");if(!tale.canUndo()){this.closeLinks()}if(el=document.getElementById("passage"+name)){el.id+="|"+(new Date).getTime()}D=tale.get(name);if(D==null){return
}if(type!="back"){this.saveVariables(D,source,callback)}this.hash=this.save();this.replaceURL();F=D.render();if(type!="quietly"){if(hasTransition){F.classList.add("transition-in");setTimeout(function(){F.classList.remove("transition-in")},1);F.style.visibility="visible"}p.appendChild(F);scrollWindowTo(F,(window.getComputedStyle?parseInt(window.getComputedStyle(p).paddingBottom):150));if(!hasTransition){fade(F,{fade:"in"
})}}else{p.appendChild(F);F.style.visibility="visible"}tale.setPageElements();return F};History.prototype.rewindTo=function(C,instant){var p2,p=document.getElementById("passages").lastChild;while(p&&p!=C){p2=p.previousSibling;if(instant){p.parentNode.removeChild(p)}else{if(hasTransition){p.classList.add("transition-out");setTimeout((function(p){return function(){if(p.parentNode){p.parentNode.removeChild(p)}}}(p)),1000)}else{fade(p,{fade:"out",onComplete:function(){this.parentNode.removeChild(this)}})}}this.history.shift();p=p2}this.hash=this.save();this.replaceURL()};Passage.prototype.render=function(){var F,D,A,t,i,E=insertElement(null,"div","passage"+this.title,"passage");E.style.visibility="hidden";this.setTags(E);this.setCSS();insertElement(E,"div","","header");F=insertElement(E,"div","","title",this.title);D=insertElement(F,"span","","toolbar");for(i=0;i<Passage.toolbarItems.length&&tale.canUndo();i++){t=Passage.toolbarItems[i];if(t.label=="bookmark"&&!tale.canBookmark()){continue
}var C=insertElement(D,"a",null,"toolbar-"+t.label.replace(/ .*/g,""));insertText(C,t.label);C.passage=this;if(t.href){C.href=t.href()}else{C.href="javascript:;"}C.title=t.tooltip;addClickHandler(C,t.activate);C.div=E}A=insertElement(E,"div","","body content");for(i in prerender){(typeof prerender[i]=="function")&&prerender[i].call(this,A)}new Wikifier(A,this.processText());insertElement(E,"div","","footer");for(i in postrender){(typeof postrender[i]=="function")&&postrender[i].call(this,A)}return E};Passage.toolbarItems=[{label:"bookmark",tooltip:"Bookmark this point in the story",href:function(){return(state.hash)},activate:function(){}},{label:"rewind to here",tooltip:"Rewind the story to this point",activate:function(){state.rewindTo(this.div)}}];Passage.transitionCache="";Passage.prototype.setCSS=function(){var trans=false,text="",tags=this.tags||[],c=document.getElementById("transitionCSS");if(c&&c.getAttribute("data-tags")!=tags.join(" ")){tale.forEachStylesheet(tags,function(passage){if(~passage.tags.indexOf("transition")){if(!Passage.transitionCache&&c){Passage.transitionCache=c.innerHTML}setTransitionCSS(passage.text);trans=true}});if(!trans&&Passage.transitionCache&&c){setTransitionCSS(Passage.transitionCache);trans=false;Passage.transitionCache="";c.setAttribute("data-tags",tags.join(" "))}}};macros.back.onclick=function(back,steps,el){var title,q,p=document.getElementById("passages");if(back){q=p.querySelectorAll(".passage");el=findPassageParent(el);if(!el){el=q[q.length-1]}if(q[0]!=el){p=el;while(p&&steps>0){p=p.previousSibling;steps--}state.rewindTo(p);return}steps+=q.length-1;removeChildren(p);while(steps>=0&&state.history.length>1){title=state.history[0].passage.title;state.history.shift();steps--}state.display(title,null,"",(function(a){if(a){return function(){for(var i in a){state.history[0].variables[i]=a[i]}}}}(state.history[0].linkVars)))}else{state.display(state.history[steps].passage.title,null)}};function setupTagCSS(){var passage,tags,i,j,text="",c=document.getElementById("tagCSS"),openBrace=function(){text+="{"},closeBrace=function(){text+="}"},handler={tag:null,keyframes:false,startAtrule:function(a,b){this.keyframes=(a.indexOf("keyframes")>=0);text+=a+" "+b},startBlock:openBrace,endBlock:closeBrace,endAtrule:function(){this.keyframes=false;closeBrace()},startRuleset:function(a){var i,rules=a.join("").split(","),passageRegex=/\.passage/,bodyRegex=/(?:^|\s)body/;if(!this.keyframes){for(i=0;i<rules.length;i++){if(rules[i].search(passageRegex)>=0){rules[i]=rules[i].replace(passageRegex,".passage[data-tags~="+this.tag+"]")}else{if(rules[i].search(bodyRegex)>=0){rules[i]=rules[i].replace(bodyRegex,"body[data-tags~="+this.tag+"]")}else{rules[i]="body[data-tags~="+this.tag+"] "+rules[i]}}}}text+=rules.join(",")+"{"},declaration:function(a,b){text+=a+" : "+b.join(" ")+";"},endRuleset:closeBrace};for(i in tale.passages){passage=tale.passages[i];if(passage&&~passage.tags.indexOf("stylesheet")){for(j=0;j<passage.tags.length;j++){if(passage.tags[j]!="transition"&&passage.tags[j]!="stylesheet"){handler.tag=passage.tags[j];parseCssStylesheet(alterCSS(passage.text),handler)}}}}c.styleSheet?(c.styleSheet.cssText=text):(c.innerHTML=text)}window.onload=function(){addClickHandler(document.getElementById("restart"),function(){if(confirm("Are you sure you want to restart this "+tale.identity()+"?")){state.restart()}});main();setupTagCSS()};

testplay = "";

// CssLexer/CssParser
// Copyright (C) 2010 Google Inc.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//      http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
//
var lexCss;var decodeCss;(function(){function w(W){var S=parseInt(W.substring(1),16);if(S>65535){return S-=65536,String.fromCharCode(55296+(S>>10),56320+(S&1023))}else{if(S==S){return String.fromCharCode(S)}else{if(W[1]<" "){return""
}else{return W[1]}}}}function L(W,S){return'"'+W.replace(/[\u0000-\u001f\\\"<>]/g,S)+'"'}function u(S){return v[S]||(v[S]="\\"+S.charCodeAt(0).toString(16)+" ")}function c(S){return y[S]||(y[S]=(S<"\x10"?"%0":"%")+S.charCodeAt(0).toString(16))}var v={"\\":"\\\\"},y={"\\":"%5c"},V="[\\t\\n\\f ]",e=V+"*",J="[\\n\\f]",q="[\\ud800-\\udbff][\\udc00-\\udfff]",z="[\\u0080-\\ud7ff\\ue000-\\ufffd]|"+q,O="[0-9a-fA-F]{1,6}"+V+"?",X="\\\\"+O,m="(?:"+O+"|[\\u0020-\\u007e\\u0080-\\ud7ff\\ue000\\ufffd]|"+q+")",a="\\\\"+m,N="(?:[\\t\\x21\\x23-\\x26\\x28-\\x5b\\x5d-\\x7e]|"+z+"|"+a+")",B="[^'\"\\n\\f\\\\]|\\\\[\\s\\S]",P="\"(?:'|"+B+')*"|\'(?:"|'+B+")*'",t="[-+]?(?:[0-9]+(?:[.][0-9]+)?|[.][0-9]+)",A="(?:[a-zA-Z_]|"+z+"|"+a+")",p="(?:[a-zA-Z0-9_-]|"+z+"|"+a+")",F=p+"+",D="-?"+A+p+"*",M="@"+D,n="#"+F,C=t,x="(?:@?-?"+A+"|#)"+p+"*",U=t+"%",l=t+D,j=t+"(?:%|"+D+")?",E="url[(]"+e+"(?:"+P+"|"+N+"*)"+e+"[)]",R="U[+][0-9A-F?]{1,6}(?:-[0-9A-F]{1,6})?",o="<!--",s="-->",h=V+"+",i="/(?:[*][^*]*[*]+(?:[^/][^*]*[*]+)*/|/[^\\n\\f]*)",b="(?!url[(])"+D+"[(]",r="~=",G="[|]=",I="[^]=",d="[$]=",g="[*]=",Q="[~|^$*]=",f="[^\"'\\\\/]|/(?![/*])",K="\\uFEFF",H=new RegExp([K,R,E,b,x,P,j,o,s,h,i,Q,f].join("|"),"gi"),T=new RegExp("\\\\(?:"+m+"|"+J+")","g"),k=new RegExp("^url\\("+e+"[\"']?|[\"']?"+e+"\\)$","gi");decodeCss=function(S){return S.replace(T,w)};lexCss=function(Y){Y=""+Y;var ac=Y.replace(/\r\n?/g,"\n").match(H)||[];var Z=0;var ad=" ";for(var aa=0,S=ac.length;aa<S;++aa){var ae=decodeCss(ac[aa]);var ab=ae.length;var W=ae.charCodeAt(0);ae=(W=='"'.charCodeAt(0)||W=="'".charCodeAt(0))?L(ae.substring(1,ab-1),u):(W=="/".charCodeAt(0)&&ab>1||ae=="\\"||ae==s||ae==o||ae=="\ufeff"||W<=" ".charCodeAt(0))?" ":/url\(/i.test(ae)?"url("+L(ae.replace(k,""),c)+")":ae;if(ad!=ae||ae!=" "){ac[Z++]=ad=ae}}ac.length=Z;return ac}})();

var parseCssStylesheet,parseCssDeclarations;
(function(){function l(b,a,f,c,e){for(var d=a++;a<f&&"{"!==b[a]&&";"!==b[a];)++a;if(a<f&&(e||";"===b[a])){e=d+1;var g=a;e<f&&" "===b[e]&&++e;g>e&&" "===b[g-1]&&--g;c.startAtrule&&c.startAtrule(b[d].toLowerCase(),b.slice(e,g));a="{"===b[a]?m(b,a,f,c):a+1;c.endAtrule&&c.endAtrule()}return a}function m(b,a,f,c){++a;for(c.startBlock&&c.startBlock();a<f;){var e=b[a].charAt(0);if("}"==e){++a;break}a=" "===e||";"===e?a+1:"@"===e?l(b,a,f,c,!1):"{"===e?m(b,a,f,c):n(b,a,f,c)}c.endBlock&&c.endBlock();return a}
function n(b,a,f,c){var e=a,d=p(b,a,f,!0);if(0>d)return d=~d,d===e?d+1:d;var g=b[d];if("{"!==g)return d===e?d+1:d;a=d+1;d>e&&" "===b[d-1]&&--d;for(c.startRuleset&&c.startRuleset(b.slice(e,d));a<f;){g=b[a];if("}"===g){++a;break}a=" "===g?a+1:q(b,a,f,c)}c.endRuleset&&c.endRuleset();return a}function p(b,a,f,c){for(var e,d=[],g=-1;a<f;++a)if(e=b[a].charAt(0),"["===e||"("===e)d[++g]=e;else if("]"===e&&"["===d[g]||")"===e&&"("===d[g])--g;else if("{"===e||"}"===e||";"===e||"@"===e||":"===e&&!c)break;0<=
g&&(a=~(a+1));return a}function r(b,a,f){for(;a<f&&";"!==b[a]&&"}"!==b[a];)++a;return a<f&&";"===b[a]?a+1:a}function q(b,a,f,c){var e=b[a++];if(!s.test(e))return r(b,a,f);var d;a<f&&" "===b[a]&&++a;if(a==f||":"!==b[a])return r(b,a,f);++a;a<f&&" "===b[a]&&++a;d=a;a=p(b,a,f,!1);if(0>a)a=~a;else{for(var g=[],h=0,k=d;k<a;++k)d=b[k]," "!==d&&(g[h++]=d);if(a<f){do{d=b[a];if(";"===d||"}"===d)break;h=0}while(++a<f);";"===d&&++a}h&&c.declaration&&c.declaration(e.toLowerCase(),g)}return a}parseCssStylesheet=
function(b,a){var f=lexCss(b);a.startStylesheet&&a.startStylesheet();for(var c=0,e=f.length;c<e;){var d;if(" "===f[c])d=c+1;else{d=f;var g=e,h=a;d=c<g?"@"===d[c].charAt(0)?l(d,c,g,h,!0):n(d,c,g,h):c}c=d}a.endStylesheet&&a.endStylesheet()};var s=/^-?[a-z]/i;parseCssDeclarations=function(b,a){for(var f=lexCss(b),c=0,e=f.length;c<e;)c=" "!==f[c]?q(f,c,e,a):c+1}})();

}());
</script>
<script title="modules">


</script>
<style id="baseCSS">
#passages {
	position:relative;
	padding-bottom: 12em;
}
.content a {
	color: #4d6ad8;
}
a.internalLink, a.externalLink, a.back, a.return, [data-passage] {
	cursor: pointer;
}
a.brokenLink {
	background-color: red;
	color: black;
}
.marked {
	background-color: pink;
	margin-right: 12px;
}
.marked[title] {
	cursor: help;
}
#floater {
	position: fixed;
	right: 0;
	top: 0;
	z-index: 5;
	background-color: #fff;
}
.toolbar {
	padding: 0;
	visibility: hidden;
}
.toolbar a {
	cursor:pointer;
}
.passage:hover .toolbar {
	visibility: visible;
}
.passage li[data-bullet] {
	list-style-type: none;
}
.passage li[data-bullet]:before {
	content: attr(data-bullet);
	position: relative;
	left: -1em;
}
.toolbar a {
	margin-left: 12px;
}
#storeArea {
	display: none;
}
img {
	vertical-align:bottom;
}
#noscript {
	font-size: 120%;
	font-weight: bold;
}
#loadingbar {
	position:fixed;
	top:0;
	left:0;
	border-top: solid #4d6ad8 6px;
	transition: width 0.5s;
}
</style>
<style id="defaultCSS">
body {
	font-family: Verdana,sans-serif;
	font-size: 62.5%;
	margin: 0;
	background-color: #f8f8f8;
	color: #303030;
	text-align: center;
}
h1,h2,h3 {
	color: #000;
	font-weight: normal;
	text-align: center;
}
#content1 {
	text-align: left;
}
h1 {
	font-size: 4em;
	line-height: 1.2em;
	margin-bottom: 0;
	margin-top: 1em;
}
h2 {
	font-size: 1.4em;
	font-style: italic;
	margin-top: 1em;
}
h3 {
	font-size: 1.3em;
	margin-bottom: 5em;
	margin-top: .8em;
}
.passage {
	background-color: #f8f8f8;
	font-size: 1.3em;
	line-height: 175%;
	margin-bottom: 2em;
}
.content a {
	font-weight: bold;
	text-decoration: none;
}
.content a:hover {
	text-decoration: underline;
	color: #8ea6ff;
}
.passage:not(:last-child):not(:hover) {
	opacity: 0.4;
	transition: 0.5s;
	-webkit-transition: 0.5s;
}
.passage center {
	max-width:50%;
	margin:auto;
}
input, button {
	font-size: 1.2em;
}
button {
	padding: 0.2em 0.8em;
}
input[type=text] {
	width: 20%;
}
.toolbar a {
	color: #999;
	text-decoration: none;
}
.toolbar a:hover {
	text-decoration: underline;
	color: #8ea6ff;
}
.title {
	color: #000;
	font: bold 1.4em Verdana,sans-serif;
	line-height: 200%;
}
#footer {
	font-size: 1.1em;
	font-style: italic;
	margin-top: 5em;
	text-align: center;
}
#footer a.externalLink {
	border-bottom: 1px solid #464646;
	color: #464646;
	font-weight: normal;
}
#floater {
	border-left: 1px solid #ddd;
	border-bottom: 2px solid #aaa;
	font-size: 1.1em;
	padding: 0 20px;
	text-align: center;
	line-height: 100%;
}
#floater ul {
	text-align: left;
}
#floater a {
	color: #999;
	cursor:pointer;
	font-weight: bold;
	text-decoration: none;
}
#floater a:hover {
	color: #8ea6ff;
	text-decoration: underline;
}
#content1 {
	margin: 0 12.7% 1em 12.7%;
	text-align: left;
}
.passage table {
	border-collapse: collapse;
	font-size: 100%;
	margin: .8em 1.0em;
}
.passage th,.passage td,.passage tr,.passage caption {
	padding: 3px;
}
.passage hr {
	height: 1px;
}

.toolbar {
	font-size: .5em;
}
.toolbar a {
	margin-left: 12px;
}
.passage ul, .passage ol {
	margin-left: .5em;
	padding-left: 1.5em;
}
li {
	list-style-type: square;
}
</style>
<style id="transitionCSS">
.transition-in {
	opacity:0;
	position: absolute;
}
.passage {
	transition: 1s;
	-webkit-transition: 1s;
}
.transition-out {
	opacity:0 !important;
}
</style>
<style id="storyCSS"></style>
<style id="tagCSS"></style>
</head>
<body>
<div id="loadingbar"></div>
<div id="floater"><div class="container">
<div id="storyMenu" class="storyElement"></div>
<p><a id="restart" href="#">Restart Story</a></p>
</div></div>
<div id="content1"><div id="content2">
<div id="header"></div><div id="titleLine"></div>
<h1><span id="storyTitle" class="storyElement"></span></h1>
<h2><span id="storySubtitle" class="storyElement"></span></h2>
<h3><span id="storyAuthor" class="storyElement"></span></h3>
<div id="passages"><noscript><div id="noscript">Please enable Javascript to play this story!</div></noscript>
<style>
#floater {display:none;}
</style></div>
<p id="footer">
This story was created with <a class="externalLink" href="http://twinery.org/">Twine</a> and is powered by <a class="externalLink" href="http://www.tiddlywiki.com/">TiddlyWiki</a>.
</p>
</div></div>
<div id="storeArea" data-size="37" hidden><div tiddler="justification: placenames" tags="" created="201611211312" modifier="twee" twine-position="850,290"></div><div tiddler="FORVM" tags="" created="201611180934" modifier="twee" twine-position="502,196">[[Project Aims]]|[[Archaeological &amp; Historical Contexts]]|[[Rules &amp; Justifications]]|[[Playtest Feedback]]|[[Walkthrough]]|[[Conclusion]]\n\nSimulations are valuable in two distinct ways. In the first, the creation of a simulation forces a formalization, an operationalization, of what we believe to be true about the past. If we write, 'many Romans attempted to improve their lot in life through attachment to the household of a higher status individual', a modeler would ask, 'what does 'attachment' mean? what does 'status' mean? how does 'attachment' work? what does 'to improve' imply?' and so on. Models and simulations work best in our view when they are focussed on operationalizing a limited number of phenomena. This is because of the second valuable aspect of simulation: by enabling us to 're-run' history under different conditions, we can begin to see the landscape of possible emergent outcomes this operationalized description of the past implies. To recap: simulation forces us to formalize what we believe about the past; and it allows the consequences of those formalizations to be systematically explored. The job of the modeler after running the simulation is to use that landscape of possibilities to better understand the past, the errors in the formalization, or to circumscribe our understanding of the various likely starting positions.\n\nA board game is another species of simulation. Indeed, one could argue that a simulation is a game that plays itself. A board-game-as-simulation therefore removes the impartial computational referee, and forces the players to interpret, understand, and contest the formalization recorded in the rules of the game. A board game is therefore a kind of 'analog simulation', in that it admits a lot of noisiness in the operations of its processes. A board game is also a valuable pedagogical tool in that it reveals the tyranny of algorithms and encourages players to play with the rules, challenge the rules, or even, re-write the rules.\n</div><div tiddler="4. build or destroy or benefaction" tags="" created="201611211313" modifier="twee" twine-position="290,710">## Building or destroying a warehouse; making a benefaction\n\n- a player may [[only|justification: time]] BUILD or DESTROY or make a [[BENEFACTION|justification: benefactions]] during this phase\n- a market may only have one [[warehouse|justification: market economy]] per player\n\n** BUILD **\n- a player may only build one warehouse per market\n- a player must have an [[agent|justification: agency]] on that market in order to build there\n- a player may only build one warehouse per turn\n- the player must [[pay $100|justification: market economy]] to build\n- the player receives + 1 [[prestige|justification: prestige]] for that player's FIRST warehouse in a region\n- the player receives + 1 [[prestige|justification: prestige]] for each FIVE warehouses of that player in a region\n- if the player puts a warehouse in EVERY market in a region that player receives + 2 [[prestige|justification: prestige]]\n\n** DESTROY **\n- a player may [[choose|justification: agency]] to [[DESTROY|justification: market economy]] another player's warehouse in a market\n- the player must pay $200\n- the player must [[roll|justification: stochastic elements]] 4+. If successful, the other player's warehouse is removed from the board\n- IF the defending player is married into the [[local aristocracy|justification: social]] at that market, the roll must be 6+\n- IF the attacking player is married into the [[local aristocracy|justification: social]] at that market, the roll must be 2+.\n\n** [[BENEFACTIONS|justification: benefactions]] **\n- for each band on the PRESTIGE [[ladder|justification: public knowledge]] [[(Quaestor, Aedile, Praetor)|justification: prestige]] there are three possible benefactions you may give.\n\n- benefactions in the QUAESTOR band cost $200 to give\n- benefactions in the AEDILE band cost $500 to give\n- benefactions in the PRAETOR band cost $1000 to give\n\n- a player can only give one benefaction per turn\n- a player places one of her [[tokens|justification: public knowledge]] on the benefaction's space on the ladder to indicate that it has been given and that no other player may give that benefection.\n- a player may only give benefactions for the band in which their prestige currently applies, e.g, a player with prestige of 4 may only give benefactions in the QUAESTOR band. If all the benefactions in that band have already been given, that player may not give a benefaction at all until their prestige level allows them to reach [[the next band|justification: benefactions]].\n\n- giving a benefaction results in prestige +1.\n\n[[1. move]] ~ [[2. social intrigues]] ~ [[3. trade]]  ~ [[4. build or destroy or benefaction]] ~ [[5. draw fate, translate money into prestige]] ~ [[6. check for victory conditions]]\n</div><div tiddler="justification: agency" tags="" created="201611211312" modifier="twee" twine-position="1304,634"></div><div tiddler="1. move" tags="" created="201611211313" modifier="twee" twine-position="271,579">## Movement\n\n- each player has the opportunity at the start of each movment phase to put one more agent on the board. This is accomplished by a [[roll of the die|justification: stochastic elements]] of 4 or higher. A [[new agent|justification: agency]] is placed on [[Rome|justification: Rome]] and may be used this turn, and be moved.\n\n- a player may not have more than one agent on Rome, and so an agent must be moved to an adjacent [[market|justification: market economy]] as part of the 1 move of that agent.\n\n- agents can move [[once per turn as part|justification: time]] of the movement phase.\n\n- agents do not have to move if the player wishes.\n\n- agents move 1 step over the network along the [[links to adjacent cities|justification: geography]].\n\nIN ALL MARKETS except for Rome, there [[can only be ONE agent|justification: playability]].\nHOWEVER:\n\t- a player can still move her agent to a market where there is another player's agent, but this situation MUST be resolved during the '[[Social Intrigues|2. social intrigues]]' phase.\n\n[[1. move]] ~ [[2. social intrigues]] ~ [[3. trade]]  ~ [[4. build or destroy or benefaction]] ~ [[5. draw fate, translate money into prestige]] ~ [[6. check for victory conditions]]\n</div><div tiddler="justification: market economy" tags="" created="201611211312" modifier="twee" twine-position="1197,399"></div><div tiddler="Start" tags="" created="201611180909" modifier="twee" twine-position="10,10">In this work we present a ludic exploration of the rules and rationale behind our experiment in building an analog simulation. That is to say, we built a board game to explore ideas about the Roman social-economy that we had previously tried to explore with agent based models.\n\nAgent Based Models (ABM), video games, and board games, are all aspects of a particular mode of play, the simulation. The crucial difference between them involves the role of the 'referee' and the role of the 'player'. By referee, we mean the entity charged with making sure the world of the simulation unfolds the way it ought.\n\n[[Board Game]]|[[ABM]]|[[Video Game]]\n\n&lt;&lt;set $abm to false&gt;&gt;\n&lt;&lt;set $boardgame to false&gt;&gt;\n&lt;&lt;set $videogame to false&gt;&gt;\n&lt;&lt;set $score to 0&gt;&gt;</div><div tiddler="Archaeological & Historical Contexts" tags="" created="201611211311" modifier="twee" twine-position="410,367">[[Project Aims]]|[[Rules &amp; Justifications]]|[[Playtest Feedback]]|[[Walkthrough]]|[[Conclusion]]\n\n\n[[network analysis of Roman connectivity]]</div><div tiddler="Conclusion" tags="" created="201611211311" modifier="twee" twine-position="570,10">In the creation of a computational simulation, the manner in which a historical or social phenomenon is operationalized literally encodes the modelers' understanding of how the past works: it is a kind of procedural rhetoric (in Bogost's felicitous phrasing, 2007). In creating an 'analog simulation', the equivalent idea is in terms of 'playability'. Board games require balancing of both positive and negative feedback loops (and considering the consequences when various loops intersect, as in the consequences of 'fate cards', for instance) in order to create the particular dynamic where in any given play-through, any given player might win - this is what we mean by playability. What makes the winner is the player's understanding of the rules, and her ability to deduce a winning strategy within them. We have made decisions at times in the writing of the rules where we considered multiple arguments about the past but chose to implement the idea we felt was the best compromise between faithfulness of the broad strokes of Roman society and playability.\n\nWe expect that players familiar with the details of any particular element we have simulated will dispute the choices that we have made. We welcome this: a simulation is only as valuable as it is a stimulation to further thought and argument and so when you find something that you feel strongly is the wrong choice on our part, we encourage you to re-write the rules, to challenge the algorithm, and develop (and justify) your own 'house' rules.\n\nThen: consider the outcome to your game. How is it better? How is it worse? What does it do to your understanding of the past? Blog your experience. Publish your thoughts. Mod our game.\n\nSimulation is a space, a landscape of outcomes. We look forward to hearing of your own explorations.\n\n&lt;&lt;if visited (&quot;Project Aims&quot;, &quot;Archaeological &amp; Historical Contexts&quot;, &quot;Walkthrough&quot;, &quot;Playtest Feedback&quot;, &quot;Rules &amp; Justifications&quot;)&gt;&gt; Your score has increased by ten points. &lt;&lt;set $score to $score + 10&gt;&gt; It currently is &lt;&lt;$score&gt;&gt;. How many other readers have achieved this? You might now enjoy the\n[[appendix: workshopping a boardgame]].&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;if visited (&quot;Walkthrough&quot;) &lt; 1&gt;&gt; &lt;&lt;set $score to $score - 10&gt;&gt;We can see that you haven't explored the [[Walkthrough]] yet. This reduces your score by 10. Your score is currently &lt;&lt;$score&gt;&gt;.&lt;&lt;endif&gt;&gt;</div><div tiddler="6. check for victory conditions" tags="" created="201611211313" modifier="twee" twine-position="128,830">[[Victory occurs|justification: playability]] IF a player has achieved 15 prestige points at the END of a turn, after all players have finished the previous phase.\n\n- If two or more players achieved 15 prestige points at the same time, the winner is the player with the most money.\n\n- If there should happen to be a tie in both prestige and money, the winner is the player who gave the most benefactions.\n\n[[1. move]] ~ [[2. social intrigues]] ~ [[3. trade]]  ~ [[4. build or destroy or benefaction]] ~ [[5. draw fate, translate money into prestige]] ~ [[6. check for victory conditions]]\n\n&lt;&lt;if visited (&quot;Aim of the Game &amp; Setup&quot;, &quot;1. move&quot;, &quot;2. social intrigues&quot;, &quot;3. trade&quot;, &quot;4. build or destroy or benefaction&quot;, &quot;5. draw fate, translate money into prestige&quot;)&gt;&gt; Your score has increased by ten points. &lt;&lt;set $score to $score + 10&gt;&gt; It currently is &lt;&lt;$score&gt;&gt;. How many other readers have achieved this?&lt;&lt;endif&gt;&gt;</div><div tiddler="justification: playability" tags="" created="201611211312" modifier="twee" twine-position="1720,562"></div><div tiddler="justification: info" tags="" created="201611211312" modifier="twee" twine-position="1529,710"></div><div tiddler="justification: public knowledge" tags="" created="201611211312" modifier="twee" twine-position="1312,961"></div><div tiddler="2. social intrigues" tags="" created="201611211313" modifier="twee" twine-position="402,582">## Social Intrigues\n\n- There are [[THREE kinds of social manouevres|justification: social]] that players can engage in:\n+ [[MARRIAGE ALLIANCE|justification: social]] with another player\n+ MARRIAGE ALLIANCE into the local aristocracy of a market\n+ [[OUSTING of Agents|justification: agency]] in a given market\n\n** Marriage alliance with another player \n\n-  a player can propose a marriage alliance during that player's social intrigues phase, to any other player.\n- both players must have an [[eligible child|justification: social]] still available for marriage of different gender, e.g, one has a boy, the other has a girl.\n- the two players [[negotiate a price|justification: social]] that the player who initiates the proposal has to pay to the other player.\n- if accepted, both players get [[+2 prestige|justification: social]]\n- players note those children are no longer available for marriage\n- marriages can be [[dissolved|justification: social]]\n- through an appropriate [[FATE|justification: stochastic elements]] card\n- through [[aggressive action|justification: agency]] by one player in the alliance towards the other (OUSTING an agent or [[DESTROYING|justification: agency]] a [[warehouse|justification: market economy]])\n- at the request of one of the players\n- if a marriage is dissolved BOTH players LOSE 2 Prestige in all cases, and the initial price MUST be repayed.\n\n-ADVANTAGES of Marriage Alliance with another player\n\t- the presence of one player's agent on the other player's  warehouse in the [[TRADE|3. trade]] phase acts as if it were second player's [[agent as well|justification: info]].\n\n** Marriage alliance into the local aristocracy of a market **\n\n- a player can marry into the '[[local aristocracy|justification: social]]' of a market on which she has an agent when:\n- the player has an elgible family member\n- the player can [[pay $200|justification: social]]\n- no other player has already married into that market's aristocracy\n- the player's prestige increases [[+1 prestige|justification: social]]\n- the player makes a note of which child was involved; that child is no longer available for intrigue.\n- the marriage can be dissolved through an appropriate FATE card\n\n-ADVANTAGES of Marriage Alliance with Local Aristocracy\n\t- a [[roll|justification: stochastic elements]] to OUST the player's agent from that market has to be 6.\n\t- the allied player can OUST other players from that market with a roll of 2 or higher.\n\t- the allied player can [[DESTROY|justification: agency]] another player's warehouse on the market with a roll of 2 or higher\n\n** OUSTING A PlAYER'S AGENT **\n\n- BECAUSE no market other than Rome can have more than one agent on it by the end of a turn:\n\t- a player must oust another player's agent when both players are on the same market\n\t- the player who was the [[SECOND to move|justification: playability]] in the market MUST initiate the ousting procedure\n\n- ousting does not affect warehouses.\n- being ousted DOES NOT dissolve a marriage alliance with the local aristocracy\n\nProcedure:\n\t- the OUSTING player [[pays $200|justification: playability]]\n\t- the OUSTING player must [[roll 4+|justification: stochastic elements]]\n\t- if the OUSTING player has a marriage alliance into the local aristocracy, the [[roll is 2+|justification: stochastic elements]] to remove the other player\n\t- if the defending player has a marriage alliance into the local aristocracy, the [[roll|justification: stochastic elements]] must be a 6\n\t- the losing player's agent is [[removed from the board|justification: agency]] (and can be reintroduced during the move phase on a 4+ roll)\n\n[[1. move]] ~ [[2. social intrigues]] ~ [[3. trade]]  ~ [[4. build or destroy or benefaction]] ~ [[5. draw fate, translate money into prestige]] ~ [[6. check for victory conditions]]\n</div><div tiddler="Rules & Justifications" tags="" created="201611211311" modifier="twee" twine-position="850,150">[[Project Aims]]|[[Archaeological &amp; Historical Contexts]]|[[Playtest Feedback]]|[[Walkthrough]]|[[Conclusion]]\n\nA summary of the main ideas underpinning things, *how* we tried to get thing across\n\n\njustification for networks:\njustifications for costs:\n\n-crosslink into the walkthrough justification cards?\n\n[[justification: public knowledge]] \n[[justification: stochastic elements]] \n[[justification: agency]] \n[[justification: geography]] \n[[justification: playability]] \n[[justification: market economy]] \n[[justification: time]] \n[[justification: social]] \n[[justification: prestige]] \n[[justification: info]] \n[[justification: benefactions]] \n[[justification: placenames]] </div><div tiddler="init" tags="startup" created="201611180912" modifier="twee" twine-position="1430,54">&lt;&lt;set $score to 0&gt;&gt;</div><div tiddler="justification: social" tags="" created="201611211312" modifier="twee" twine-position="850,570"></div><div tiddler="Aim of the Game & Setup" tags="" created="201611211313" modifier="twee" twine-position="136,577">## Aim of the Game\nBecome the [[most prestigious Roman|justification: prestige]] through trade and treachery!\n\n- First person to 15 prestige points wins the consulship, and the game.\n\n## Game Set Up\n\n- for 3 to 4 players\n- everyone has $200 to start\n- place each player's [[money counter|justification: public knowledge]] on the money ladder.\n- each player has a son and daughter; these are not represented by any tokens.\n- shuffle the [[fate cards|justification: stochastic elements]] and place face down on the board\n- prestige for everyone at the start is 0.\n- Place [[prestige counters|justification: public knowledge]] on the prestige ladder on the board.\n- Players may only go into [[debt|justification: public knowledge]], if necessary, in any phase, if they have more than 0 prestige; players may borrow money at the rate of $100 per 1 prestige point.\n- [[roll the dice|justification: stochastic elements]] to determine who will play first. Highest roll wins; play proceeds clockwise.\n- each player has four [[agent|justification: agency]] tokens; each player places one token on [[Rome|justification: Rome]].\n\n## Order of Play\n- the game is played in a [[series of turns|justification: time]]; each turn has a sequence of distinct phases. Each phase is completed in sequence.\n- the [[phases|justification: time]] within a turn are:\n- [[1. move]] \n- [[2. social intrigues]] \n- [[3. trade]] \n- [[4. build or destroy or benefaction]] \n- [[5. draw fate, translate money into prestige]] \n- [[6. check for victory conditions]]\n\t- Victory conditions are [[assessed at the end of the turn|justification: playability]] if necessary.\n\nIf player 'Alice' starts the turn, Alice is the first person to do each phase _within_ that turn. All players complete a phase before the next phase begins. Thus, Alice starts, then Alice moves, then Bob, then Charlie. Then Alice does the next phase ('Social Intrigue'), then Bob, then Charlie, and so on.\n\nThe next turn 'Bob' starts, and then Bob is the first person to do each phase within that turn. Thus, Bob moves his agents, then Charlie, then Alice.</div><div tiddler="StoryTitle" tags="" created="201611180909" modifier="twee" twine-position="10,150">On Analog Simulation</div><div tiddler="network analysis of Roman connectivity" tags="" created="201611211312" modifier="twee" twine-position="10,430"></div><div tiddler="Playtest Feedback" tags="" created="201611211311" modifier="twee" twine-position="404,41">[[Project Aims]]|[[Archaeological &amp; Historical Contexts]]|[[Rules &amp; Justifications]]|[[Walkthrough]]|[[Conclusion]]</div><div tiddler="justification: benefactions" tags="" created="201611211312" modifier="twee" twine-position="710,710"></div><div tiddler="Board Game" tags="" created="201611180911" modifier="twee" twine-position="150,430">&lt;&lt;set $score to $score + 1&gt;&gt;\n\nA board game is a kind of simulation where the humans are both the referees and the players. (Your score is &lt;&lt;$score&gt;&gt;. When you reach a certain threshold, you'll be able to move beyond this section.)\n\n&lt;&lt;if visited (&quot;ABM&quot;) &lt; 1&gt;&gt;[[ABM]]&lt;&lt;endif&gt;&gt; &lt;&lt;if visited (&quot;Video Game&quot;) &lt; 1&gt;&gt;[[Video Game]]&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;if visited (&quot;ABM&quot;, &quot;Board Game&quot;, &quot;Video Game&quot;)&gt;&gt;This article is tracking your reading; it is keeping score, and revealing or hiding passages based on whether or not you've explored all of its possibility space. Since you've explored all three points on our ludic traingle, let's open up the rulebook for [[FORVM]] and explore how this so-called 'analog simulation' may work.&lt;&lt;endif&gt;&gt;</div><div tiddler="ABM" tags="" created="201611180911" modifier="twee" twine-position="155,161">&lt;&lt;set $score to $score + 1&gt;&gt;\n\nAn agent based model is a kind of game where the artificial intelligence acts as **both** the referee **and** the player. (Your score is &lt;&lt;$score&gt;&gt;. How odd, that simple movement through the paths of this text, should be scored. )\n\n&lt;&lt;if visited (&quot;Board Game&quot;) &lt;1&gt;&gt;[[Board Game]]&lt;&lt;endif&gt;&gt; &lt;&lt;if visited (&quot;Video Game&quot;) &lt; 1 &gt;&gt; [[Video Game]] &lt;&lt;endif&gt;&gt;\n\n&lt;&lt;if visited (&quot;ABM&quot;, &quot;Board Game&quot;, &quot;Video Game&quot;)&gt;&gt;This article is tracking your reading; it is keeping score, and revealing or hiding passages based on whether or not you've explored all of its possibility space. Since you've explored all three points on our ludic traingle, let's open up the rulebook for [[FORVM]] to see how these observations on game are instantiated.&lt;&lt;endif&gt;&gt;</div><div tiddler="appendix: workshopping a boardgame" tags="" created="201611211313" modifier="twee" twine-position="710,10"></div><div tiddler="justification: Rome" tags="" created="201611211315" modifier="twee" twine-position="1802,1100"></div><div tiddler="5. draw fate, translate money into prestige" tags="" created="201611211313" modifier="twee" twine-position="428,717">## draw fate; then translate money into prestige\n\nThe player who began the TURN draws a [[fate card|justification: stochastic elements]] and reads it to the players. All players take whatever actions or consequences that the fate card specifies. The fate card is then discarded. ([[List of all fate cards]]).\n\nAfter this, all players translate their respective amounts of [[money into prestige|justification: prestige]].\n\n- when a player's available money INCREASES past a multiple of $1000 mark as a result of the current turn's events, the player EARNS 1 prestige.\n- when a player's available money DECREASES past a multiple of $1000 mark as a result of the current turn's events, the player LOSES 1 prestige.\n- if a player needs to go into DEBT at any PHASE of a turn, the player loses 1 prestige per $100.\n- Prestige cannot go below 0.\n\n## Summary of actions that affect prestige throughout the game\n\n- marriage alliance accepted from another player: + 2 both players\n- marriage alliance dissolved: - 2 both players\n- marriage into local aristocracy: + 1\n- first warehouse in a province: + 1\n- five warehouses in a province: + 1\n- warehouses in every market in a region: + 2\n- benefaction: + 1\n- end of each turn increase of money past a multiple of $1000: + 1\n- end of each turn decrease of money past a multiple of $1000: - 1\n- debt per $100: - 1\n- if you lose your only warehouse in a given region, you lose 1 prestige.\n\n[[1. move]] ~ [[2. social intrigues]] ~ [[3. trade]]  ~ [[4. build or destroy or benefaction]] ~ [[5. draw fate, translate money into prestige]] ~ [[6. check for victory conditions]]\n</div><div tiddler="justification: stochastic elements" tags="" created="201611211312" modifier="twee" twine-position="1539,278"></div><div tiddler="3. trade" tags="" created="201611211313" modifier="twee" twine-position="141,700">## Trade\n\n- the returns on trade depend on [[distance from Rome|justification: geography]] and [[informational uncertainty|justification: info]]\n- the [[return|justification: market economy]] in any one market also depends on the number of [[warehouses|justification: market economy]] exploiting that market; more warehouses lower the profit per player\n- players count up the value for each market they have a warhouse in\n- each market indicates the value available depending on number of warehouse in it\n\n\n- WHEN a player has an agent IN ROME and in a market with warehouses in BOTH cities, [[informational uncertainty|justification: info]] is REMOVED and the player receives the trade boost for that market, as indicated by the table of values on the board.\n\n- If by the trade phase a player has a [[path|justification: geography]] from ROME to any [[EXOTIC market|justification: market economy]] (ie a warehouse in each market on any path of at least five steps starting in Rome and ending in the exotic market): the player receives the FULL value for the exotic market without having to have an agent present.\n\n- players keep track of their money by moving their token along the [[money ladder|justification: public knowledge]] on the board\n\n[[1. move]] ~ [[2. social intrigues]] ~ [[3. trade]]  ~ [[4. build or destroy or benefaction]] ~ [[5. draw fate, translate money into prestige]] ~ [[6. check for victory conditions]]\n</div><div tiddler="Video Game" tags="" created="201611180911" modifier="twee" twine-position="151,290">&lt;&lt;set $score to $score + 1&gt;&gt;\n\nA video game is a simulation where the computer is the referee and the human is the player. (Your score is &lt;&lt;$score&gt;&gt;. Like many digital things, your path through this text is watching you, assigning differing values to the choices you make. We could say that it is learning.)\n\n&lt;&lt;if visited (&quot;ABM&quot;) &lt; 1&gt;&gt;[[ABM]]&lt;&lt;endif&gt;&gt; &lt;&lt;if visited (&quot;Board Game&quot;) &lt; 1&gt;&gt;[[Board Game]]&lt;&lt;endif&gt;&gt;\n\n&lt;&lt;if visited (&quot;ABM&quot;, &quot;Board Game&quot;, &quot;Video Game&quot;)&gt;&gt;This article is tracking your reading; it is keeping score, and revealing or hiding passages based on whether or not you've explored all of its possibility space. Since you've explored all three points on our ludic traingle, let's open up the rulebook for [[FORVM]] to explore the logic and implementation of this so-called 'analog simulation'.&lt;&lt;endif&gt;&gt;</div><div tiddler="justification: prestige" tags="" created="201611211312" modifier="twee" twine-position="1502,859">- this should also connect to [[justification: public knowledge]]  public knowledge</div><div tiddler="justification: time" tags="" created="201611211312" modifier="twee" twine-position="850,430"></div><div tiddler="Walkthrough" tags="" created="201611211311" modifier="twee" twine-position="574,377">[[Project Aims]]|[[Archaeological &amp; Historical Contexts]]|[[Rules &amp; Justifications]]|[[Playtest Feedback]]|[[Conclusion]]\n\nIn FORVM, players compete to become the most prestigious Roman by having their agents engage in trade in markets across the Roman Empire. In each turn, agents are set out one step at a time across the network of markets to establish horrea (warehouses) or destroy other players' horrea, negotiate alliances or break them apart, establish a presence in a region or prevent another agent from accessing it.\n\nTrade functions through every market where a player has established a warehouse. The further from Rome, the higher the transport and information costs and the lower the profit. But agents who are connected back to Rome are better informed, and so can get a better return. At the edges of Empire fortunes can be made accessing the wealth of the East, the South, or the North!\n\nMoney is not the only way for a player to grow in prestige; a combination of clever board control and alliances and benefactions allow a player to move up the cursus honorum (prestige ladder) to become Consul! But fate will always play a role, and can upset the most intricate of plans.\n\nSummary of the Rules - the phases below are performed in turn by each player.\n\n[[Aim of the Game &amp; Setup]]\n\n[[1. move]]\n\n[[2. social intrigues]]\n\n[[3. trade]]\n\n[[4. build or destroy or benefaction]]\n\n[[5. draw fate, translate money into prestige]]\n\n[[6. check for victory conditions]] \n</div><div tiddler="Project Aims" tags="" created="201611211311" modifier="twee" twine-position="325,193">[[Archaeological &amp; Historical Contexts]]|[[Rules &amp; Justifications]]|[[Playtest Feedback]]|[[Walkthrough]]|[[Conclusion]]\n\nForum is a boardgame based on current theories of the functioning of the Roman economy, and also draws on the independent research agendas of Brughmans and Graham (see bibliography). Forum aims to highlight the integration, impact, and interplay of both physical transport networks and social networks, as well as the interwoven roles of money and prestige.\n\nThe Roman Empire in the first centuries AD spanned a huge area: from the British Isles and Spain in the west, to Egypt and Syria in the east. Despite its size, goods produced in all corners of the empire as well as exotic goods from outside the empire were available on markets throughout the empire. No market was as important as that of the capital of Rome (for a deep discussion of Rome's distorting effects on the socio-economics of Empire, see Morley xxx, Temin xxxx, Bang, xxx, as well as the work of Wilson et al. xxxx). The city had a huge population that constantly needed to be supplied with all manner of foodstuffs, utilities and luxury goods (most famously depicted in the Book of Revelation as the Whore of Babylon, eating the resources of the world).\n\nIn Forum, you play a senator (an aristocrat) based in the capital of Rome who aims to establish the greatest trade empire in order to use its proceeds for funding your political career.\n\nAristocrats were not directly involved in trade themselves. That is to say, they at least did not want to be seen as being commercial moneymakers. But it is clear that commercial interests and profits were key to the accumulation of the aristocracy's riches. This is why in Forum you work through a group of commercial agents who act as your representatives. They follow your orders to establish warehouses to supply for the demand in tradable goods in different markets around the empire. The size of the empire and the limited communication and transportation technologies available in Roman times mean that the physical distance between markets was a real barrier. It took commercial agents a certain amount of time to move goods between Rome and other markets. This is reflected in the lower profits the further you move away from Rome in the network of FORUM: the longer the travel distance from Rome, the higher the transportation costs.\n\nYou also support your agents by ensuring they are well informed about the prices, supplies and demands of goods in different markets around the empire. The physical distance between markets in the huge Roman Empire affected the availability and reliability of commercial information current at different markets. It was key to establish reliable social networks between commercial agents to ensure they could remained well informed about current prices and could get the best deal at different markets outside Rome (see for instance the work of Laurence, xxxx on 'space-economy'). In Forum, this is reflected in the trade boost agents at markets with a warehouse get if you also have an agent and a warehouse in Rome: a secure communication link is established between your home base in Rome and your warehouse at a market, your agent there is better informed and consequentially can get a better deal at the market (hence the trade boost which mitigates the money lost through transportation and making trade more profitable).\n\nThe games of Roman prestige, of patronage and client-ship, depended on seeing and being seen to have economic power, or to wield influence. Traditionally, this game of seeing and being seen played out in the ritual of the morning salutatio where clients presented themselves to their patron each morning; patrons would receive clients in the order of their prestige. The procession to the Forum of a morning of a patron with his clients was therefore an opportunity to signal to others the number and quality of one's clients and hence likely political power. Similarly, the Roman aristocracy could signal their power and prestige by their ability to command resources for the construction of temples or other urban architecture. This 'competitive building' reached its apotheosis in the urban renewal and building projects of the late Republic, but of course it could also find its outlet in the renovation of temples, basilica, and so on, or in donations of food, or the giving of games. In Forum a player's prestige and their current wealth is prominently displayed on the board, so that players can take into account others' wealth and standing as they formulate their strategies. Similarly, marriages and strategic divorce was a weapon that elite Romans wielded to great effect, to heighten prestige, to enable advantage, or compel lesser individuals to bend to the patron's will. Roman marriage is an extremely complicated institution, and depends very much on the social context of the individuals involved. In the version that we imagine here, the 'children' of the player are pawns to be traded to protect interests or to obtain advantages. The dissolution of marriage carries consequences that broadly are in line with what we know about the marriages and divorces of high ranking individuals.</div><div tiddler="StoryAuthor" tags="" created="201611180909" modifier="twee" twine-position="10,290">Tom Brughmans, Iza Romanowska, and Shawn Graham\n&lt;img src=&quot;https://raw.githubusercontent.com/shawngraham/tb-cuvisit/master/ludic-triangle.png&quot;&gt; </div><div tiddler="justification: geography" tags="" created="201611211312" modifier="twee" twine-position="850,710"></div><div tiddler="List of all fate cards" tags="" created="201611211316" modifier="twee" twine-position="990,10"></div></div></body></html>